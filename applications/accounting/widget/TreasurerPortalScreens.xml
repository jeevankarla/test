<?xml version="1.0" encoding="UTF-8"?>
<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">
        
   <!--   <screen name="CommonTreasurerPortalDecorator">
        <section>
            <actions>
                <set field="headerItem" value="FindFinAccount"/>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <not><if-service-permission service-name="acctgFinAcctPermissionCheck" main-action="VIEW"/></not>
                            </condition>
                            <widgets>
                                <label style="h3" text="${uiLabelMap.AccountingViewPermissionError}"/>
                            </widgets>
                        </section>
                        <decorator-section-include name="body"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen> -->
    <screen name="ListNewBankAccounts">
        <section>
            <actions>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/> 
            </actions>
            <widgets>
                    <include-screen name="FindFinAccountPortal"/>
            </widgets>
        </section>
    </screen>
     <screen name="FindFinAccountPortal">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleFindFinAccount"/>
                  <set field="tabButtonItem" value="FindFinAccountAlt"/>
                 <set field="tabButtonItem2" value="FindFinAccountAlt"/>
                <set field="viewIndex" from-field="parameters.VIEW_INDEX" type="Integer" default-value="0"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="20"/>
               <!--  <set field="displayAdvancedSearch" from-field="parameters.displayAdvancedSearch"/> -->
                <set field="parameters.ownerPartyId" value="Company"/>
                <set field="parameters.finAccountTypeId" value="BANK_ACCOUNT"/>
                <set field="parameters.statusId" value="FNACT_ACTIVE"/>
                <set field="noConditionFind" value="Y"/>
                <!-- <field name="noConditionFind"><hidden value="Y"/> -->
                <set field="screenFlag" value="BANKACCOUNT" /> 
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/>
            </actions>
             <widgets>
                    <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<section>
							<widgets>
								<container style="button-bar">
									<link target="FinAccountAlt.csv" text="Export As CSV" style="buttontext create">	
									</link>
									<link target="FinAccountAlt.pdf" text="Export As PDF" style="buttontext create">				
									</link>
								</container> 
								<screenlet title="Bank Accounts List">				
									 <include-form name="ListFinAccountsAlt" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
							</widgets>      
                    	</section>
               </widgets>
        </section>
    </screen>
    <!-- <screen name="FindDepositAccount">
        <section>
            <actions>
                <set field="titleProperty" value="Deposit Accounts"/>
                  <set field="tabButtonItem" value="FindDepositAccount"/>
                 <set field="tabButtonItem2" value="FindDepositAccount"/>
                <set field="viewIndex" from-field="parameters.VIEW_INDEX" type="Integer" default-value="0"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="20"/>
                <set field="parameters.ownerPartyId" value="Company"/>
                <set field="parameters.finAccountTypeId" value="DEPOSIT_ACCOUNT"/>
                <set field="noConditionFind" value="Y"/>
                <set field="screenFlag" value="DEPOSIT_ACCOUNT" /> 
                <set field="parameters.screenFlag" value="DEPOSIT_ACCOUNT" /> 
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
            </actions>
            <widgets>
              <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml"> 
                    <decorator-section name="body">
                    <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                   	<container style="button-bar">
	                    <link target="EditDepositFinAccount" text="Create Deposit Account" style="buttontext create"/>
                    </container>
                   	<section>
						<widgets>
							<screenlet title="Deposit Accounts List">				
								 <include-form name="ListDepositAccounts" location="component://accounting/widget/TreasurerPortalForms.xml"/>
							</screenlet>
						</widgets>      
                   	</section>
                   </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen> -->
    <screen name="FindDepositAccount">
        <section>
            <actions>
                <set field="titleProperty" value="Find Deposit Accounts"/>
                  <set field="tabButtonItem" value="FindDepositAccount"/>
                 <set field="tabButtonItem2" value="FindDepositAccount"/>
                <set field="viewIndex" from-field="parameters.VIEW_INDEX" type="Integer" default-value="0"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="20"/>
                <set field="noConditionFind" value="N"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/>
                <entity-condition list="finAccountTypes" entity-name="FinAccountType">
                	<condition-list combine="or">
                		<condition-expr field-name="parentTypeId" operator="equals" value="DEPOSIT_PAID"/>
                		<condition-expr field-name="parentTypeId" operator="equals" value="DEPOSIT_RECEIPT"/>
                	</condition-list>
                </entity-condition>
                <entity-condition list="companyBanksList" entity-name="FinAccount">
            		<condition-list combine="and">
            			<condition-list combine="or">
            				<condition-expr field-name="finAccountTypeId" operator="equals" value="BANK_ACCOUNT"/>
            				<condition-expr field-name="finAccountTypeId" operator="equals" value="CASH"/>
            				<condition-expr field-name="finAccountTypeId" operator="equals" value="TAX_CREDIT"/>
            			</condition-list>
            			<condition-expr field-name="statusId" operator="equals" value="FNACT_ACTIVE"/>
            			<condition-expr field-name="ownerPartyId" operator="equals" value="Company"/>
            		</condition-list>
            	</entity-condition>
            </actions>
            <widgets>
            	<decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml"> 
              		<decorator-section name="body">
                    	<container style="button-bar">
	                    	<link target="EditDepositFinAccount" text="Create Deposit Account" style="buttontext create"/>
                    	</container>
                    	<section>
							<widgets>
								<screenlet title="Find Deposit Account">				
									 <include-form name="FindDepositAccount" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
								<platform-specific>
                                    <html><html-template location="component://accounting/webapp/accounting/finaccounttrans/DepositContraRefund.ftl"/></html>
                                </platform-specific>
								<screenlet title="List Deposit Account">				
									 <include-form name="ListDepositAccounts" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
							</widgets>      
	                   	</section>
                   </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="WithdrawFromDepositAcct">
        <section>
            <actions>
			   <set field="titleProperty" value="Withdraw From Acct" />
               <!--   <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                <set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/> -->
                <set field="tabButtonItem" value="FindDepositAccount"/>
                <set field="tabButtonItem2" value="WithdrawFromDepositAcct"/>
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <property-to-field field="defaultCurrencyUomId" resource="general" property="currency.uom.id.default" default="INR"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
                <set field="screenFlag" value="DEPOSIT_ACCOUNT"/>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/> 
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <set field="parameters.finAccountTransTypeId" value="DEPOSIT"/>
                <set field="parameters.parentTypeId" value="DISBURSEMENT"/>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/WithdrawDepositFinAcct.groovy"/>
<!--                 <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentTransaction.js" global="true"/> -->
                <!-- <set field="finAccountTransId" from-field="parameters.finAccountTransId"/> -->
            </actions>           
            <widgets>
            	<decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="DepositAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<section>
							<widgets>
								<label style="h1" text="${uiLabelMap.AccountingEditDepositAcct}" ></label>
								<screenlet title="Withdraw from Account">				
									<include-form name="WithdrawAcctFinTransEntry" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
							</widgets>      
                    	</section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="DepositToDepositAcct">
        <section>
            <actions>
			   <set field="titleProperty" value="Deposit to Acct" />
                <set field="tabButtonItem" value="FindDepositAccount"/>
                <set field="tabButtonItem2" value="DepositToDepositAcct"/>
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <property-to-field field="defaultCurrencyUomId" resource="general" property="currency.uom.id.default" default="INR"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
                <set field="screenFlag" value="DEPOSIT_ACCOUNT"/>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/> 
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <set field="parameters.finAccountTransTypeId" value="WITHDRAWAL"/>
                <set field="parameters.parentTypeId" value="RECEIPT"/>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/WithdrawDepositFinAcct.groovy"/>
            </actions>           
            <widgets>
            	<decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="DepositAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<section>
							<widgets>
								<label style="h1" text="${uiLabelMap.AccountingEditDepositAcct}" ></label>
								<screenlet title="Deposit To Account">				
									<include-form name="DepositAcctFinTransEntry" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
							</widgets>      
                    	</section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="FindNonBankAccount">
        <section>
            <actions>
                <set field="titleProperty" value="Non Financial Accounts"/>
                  <set field="tabButtonItem" value="FindNonBankAccount"/>
                 <set field="tabButtonItem2" value="FindNonBankAccount"/>
                <set field="viewIndex" from-field="parameters.VIEW_INDEX" type="Integer" default-value="0"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="20"/>
               <!--  <set field="displayAdvancedSearch" from-field="parameters.displayAdvancedSearch"/> -->
                <set field="parameters.ownerPartyId" value="Company"/>
               <!--  <set field="parameters.finAccountTypeId" value="BANK_ACCOUNT"/> -->
                <set field="noConditionFind" value="Y"/>
                <set field="screenFlag" value="NON_BANKACCOUNT" /> 
                <set field="parameters.screenFlag" value="NON_BANKACCOUNT" /> 
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
            </actions>
            <widgets>
              <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml"> 
                    <decorator-section name="body">
                    <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<section>
							<widgets>
								<screenlet title="Non Bank Accounts List">				
									 <include-form name="ListNonBankAccounts" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
							</widgets>      
                    	</section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>  
    <screen name="FindFinAccountAlt">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleFindFinAccount"/>
                  <set field="tabButtonItem" value="FindFinAccountAlt"/>
                 <set field="tabButtonItem2" value="FindFinAccountAlt"/>
                <set field="viewIndex" from-field="parameters.VIEW_INDEX" type="Integer" default-value="0"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="20"/>
               <!--  <set field="displayAdvancedSearch" from-field="parameters.displayAdvancedSearch"/> -->
                <set field="parameters.ownerPartyId" value="Company"/>
                <set field="parameters.finAccountTypeId" value="BANK_ACCOUNT"/>
                <set field="noConditionFind" value="Y"/>
                <!-- <field name="noConditionFind"><hidden value="Y"/> -->
                <set field="screenFlag" value="BANKACCOUNT" /> 
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
              <!--   <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/> --> 
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/>
            </actions>
            <widgets>
                    <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml"> 
                    <decorator-section name="body">
                    <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<section>
							<widgets>
								<container style="button-bar">
									<link target="FinAccountAlt.csv" text="Export As CSV" style="buttontext create">	
									</link>
									<link target="FinAccountAlt.pdf" text="Export As PDF" style="buttontext create">				
									</link>
								</container>
								<screenlet title="Bank Accounts List">				
								 <include-form name="ListFinAccountsAlt" location="component://accounting/widget/TreasurerPortalForms.xml"/> 
								</screenlet>
							</widgets>      
                    	</section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="EditDepositFinAccount">
        <section>
            <actions>
                <set field="titleProperty" value="Edit Deposit Account"/>
                <set field="tabButtonItem"  value="FindDepositAccount"/>
                <set field="tabButtonItem2" value="EditDepositFinAccount"/>
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <property-to-field field="defaultCurrencyUomId" resource="general" property="currency.uom.id.default" default="INR"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
                <set field="screenFlag" value="DEPOSIT_ACCOUNT"/>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/> 
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
            	<script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
            	<entity-condition list="receiptAccounts" entity-name="FinAccountType">
            		<condition-expr field-name="parentTypeId" operator="equals" value="DEPOSIT_RECEIPT"/>
            	</entity-condition>
            	<entity-condition list="paidAccounts" entity-name="FinAccountType">
            		<condition-expr field-name="parentTypeId" operator="equals" value="DEPOSIT_PAID"/>
            	</entity-condition>
            	<entity-condition list="companyBanksList" entity-name="FinAccount">
            		<condition-list combine="and">
            			<condition-list combine="or">
            				<condition-expr field-name="finAccountTypeId" operator="equals" value="BANK_ACCOUNT"/>
            				<condition-expr field-name="finAccountTypeId" operator="equals" value="CASH"/>
            			</condition-list>
            			<condition-expr field-name="statusId" operator="equals" value="FNACT_ACTIVE"/>
            			<condition-expr field-name="ownerPartyId" operator="equals" value="Company"/>
            		</condition-list>
            	</entity-condition>
            </actions>
            <widgets>
              <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                      <!-- <include-menu name="DepositAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/> -->
                        <section>
                            <condition>
                            	<if-service-permission service-name="acctgFinAcctPermissionCheck" main-action="FINACCOUNT_EDIT"/>
                                <not><if-empty field="finAccountId" /></not>
                            </condition>
                            <widgets>
                                <label style="h1" text="${uiLabelMap.AccountingEditDepositAcct}" ></label>
                                <platform-specific>
                                    <html><html-template location="component://accounting/webapp/accounting/finaccounttrans/SetDepositAccntTypeDropDown.ftl"/></html>
                                </platform-specific>
                                <screenlet title="Edit Deposit Account">
                                    <include-form name="EditDepositAccount" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h1" text="${uiLabelMap.AccountingCreateNewFinAccount}"></label>
                                <screenlet id="CreateFinAccountPanel" collapsible="true">
                                    <include-form name="EditFinAccount" location="component://accounting/widget/FinAccountForms.xml"/>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>  
    <screen name="EditFinAccountAlt">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleEditFinAccount"/>
              <!--   <set field="tabButtonItem" value="${parameters.tabButtonItem}" value="${tabButtonItem}" /> -->
                	<set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/>
                 <set field="tabButtonItem2" value="EditFinAccountAlt"/>
                
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <property-to-field field="defaultCurrencyUomId" resource="general" property="currency.uom.id.default" default="INR"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNT_EDIT"/>
                </service>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/> 
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
            <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
            </actions>
            <widgets>
              <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
             <!--    <decorator-screen name="CommonFinAccountDecorator" location="${parameters.finAccountDecoratorLocation}"> -->
                    <decorator-section name="body">
                      <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <condition>
                            	<if-service-permission service-name="acctgFinAcctPermissionCheck" main-action="FINACCOUNT_EDIT"/>
                                <not><if-empty field="finAccountId" /></not>
                            </condition>
                            <widgets>
                               <!--  <container style="button-bar">
                                    <link target="EditFinAccount" text="${uiLabelMap.AccountingCreateNewFinAccount}" style="buttontext create"/>
                                </container> -->
                                <label style="h1" text="${uiLabelMap.AccountingEditBank}" ></label>
                                <screenlet id="EditFinAccountPanel" collapsible="true">
                                    <include-form name="EditBankAccount" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="h1" text="${uiLabelMap.AccountingCreateNewFinAccount}"></label>
                                <screenlet id="CreateFinAccountPanel" collapsible="true">
                                    <include-form name="EditFinAccount" location="component://accounting/widget/FinAccountForms.xml"/>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>  
     <screen name="FindFinAccountTransAlt">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleFindBankAccountTrans"/>
                <!--   <set field="tabButtonItem" value="FindFinAccountAlt"/> -->
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                  	<set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/>
                <set field="tabButtonItem2" value="FinAccountTrans"/>
                <set field="glReconciliationId" value="${parameters.glReconciliationId}"/>
                <service service-name="getFinAccountTransListAndTotals" result-map="finAccountTransListAndTotals" auto-field-map="true"/>
                <set field="finAccountTransList" type="List" from-field="finAccountTransListAndTotals.finAccountTransList"/>
                <set field="searchedNumberOfRecords" type="Integer" from-field="finAccountTransListAndTotals.searchedNumberOfRecords"/>
                <set field="grandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.grandTotal"/>
                <set field="createdGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdGrandTotal"/>
                <set field="totalCreatedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedTransactions"/>
                <set field="approvedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.approvedGrandTotal"/>
                <set field="totalApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalApprovedTransactions"/>
                <set field="createdApprovedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdApprovedGrandTotal"/>
                <set field="totalCreatedApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedApprovedTransactions"/>
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <set field="glReconciliationId" from-field="parameters.glReconciliationId"/>
                <set field="finAccountTransId" from-field="parameters.finAccountTransId"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNTTX_EDIT"/>
                </service>
                <set field="hasFinTxEditPermission" from-field="permResult.hasPermission"/> 
            </actions>
            <widgets>
               <!--   <decorator-screen name="CashierCommonDecorator" location="component://accounting/widget/CommonScreens.xml"> -->
                    <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
             <!--    <decorator-screen name="CommonFinAccountDecorator" location="${parameters.finAccountDecoratorLocation}"> -->
                    <decorator-section name="body">
                        <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<!-- <section>
                    		<condition>
                    			<if-compare operator="equals" value="true" field="hasFinTxEditPermission"/>
                    		</condition>
                    		<widgets>
                        		<link target="EditFinAccountTrans" text="${uiLabelMap.AccountingFinAccountTransationsAdjustment}" style="buttontext">
                           			<parameter param-name="finAccountId" from-field="finAccountId"/>
                           			<parameter param-name="finAccountTransTypeId" value="ADJUSTMENT"/>
                           			<parameter param-name="entryType" value="Adjustment"/>                           			
                        		</link>
                        		<link target="EditFinAccountTrans" text="${uiLabelMap.AccountingFinAccountTransationsPayment}" style="buttontext">
                           			<parameter param-name="finAccountId" from-field="finAccountId"/>
                           			<parameter param-name="entryType" value="Payment"/>                           			
                        		</link>
                        		<link target="EditFinAccountTrans" text="${uiLabelMap.AccountingFinAccountTransationsContra}" style="buttontext">
                           			<parameter param-name="finAccountId" from-field="finAccountId"/>                           			
                           			<parameter param-name="entryType" value="Contra"/>
                           		</link>                        
                        	</widgets>
                        	</section> -->
                        <section>
                            <condition>
                            	<if-service-permission service-name="acctgFinAcctPermissionCheck"  main-action="FINACCOUNTREC_EDIT"> </if-service-permission>
                                <if-compare field="finAccount.finAccountTypeId" operator="equals" value="BANK_ACCOUNT" type="String"></if-compare>
                            </condition>
                            <widgets>
                              <!--   <link target="FinancialAccountReconciliation" text="${uiLabelMap.FinAccountReconciliation}" style="buttontext">
                                    <parameter param-name="finAccountId" from-field="finAccountId"/>
                                    <parameter param-name="statusId" value="FINACT_TRNS_CREATED"/>
                                </link> -->
                            </widgets>
                        </section>
                        <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                            <decorator-section name="search-options">
                                <include-form name="FindFinAccountTransactionsAlt" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                            </decorator-section> 
                            <decorator-section name="search-results">
                                <platform-specific>
                                    <html><html-template location="component://accounting/webapp/accounting/finaccounttrans/FinAccountTrans.ftl"/></html>
                                </platform-specific>
                            </decorator-section>
                        </decorator-screen>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
      <screen name="FinAccountTransForReconsile">
        <section>
            <actions>
                <set field="titleProperty" value="CreateBankAccountReconciliationsTitle"/>
                <!--   <set field="tabButtonItem" value="FindFinAccountAlt"/> -->
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                  	<set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/>
               <!--  <set field="tabButtonItem2" value="${parameters.subTabItem}"/> -->
                <set field="tabButtonItem2" value="FinAccountTransForReconsile"/>
                <set field="parameters.glReconciliationId" value="${glReconciliationId}"/><!-- instead of Form we are setting in Screen  -->
                <set field="parameters.finAccountId" value="${finAccountId}"/>
                 <set field="parameters.statusId" value="FINACT_TRNS_CREATED"/>
                 <set field="glReconciliationId" value="${glReconciliationId}"/>
                   <set field="glReconciliationId" value="${glReconciliationId}"/>
                   <!-- <set field="parameters.fromTrnsactionDate" from-field="parameters.fromTransactionDate" />
                  <set field="parameters.thruTransactionDate" from-field="parameters.thruTransactionDate" /> -->
               <!--   <set field="parameters.noConditionFind" value="Y"/> -->
                 
                <service service-name="getFinAccountTransListAndTotals" result-map="finAccountTransListAndTotals" auto-field-map="true"/>
                <set field="finAccountTransList" type="List" from-field="finAccountTransListAndTotals.finAccountTransList"/>
                <set field="searchedNumberOfRecords" type="Integer" from-field="finAccountTransListAndTotals.searchedNumberOfRecords"/>
                <set field="grandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.grandTotal"/>
                <set field="createdGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdGrandTotal"/>
                <set field="totalCreatedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedTransactions"/>
                <set field="approvedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.approvedGrandTotal"/>
                <set field="totalApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalApprovedTransactions"/>
                <set field="createdApprovedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdApprovedGrandTotal"/>
                <set field="totalCreatedApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedApprovedTransactions"/>
                 <set field="finAccountId" from-field="parameters.finAccountId"/> 
                <entity-one entity-name="FinAccount"  value-field="finAccount"/>
                <set field="glReconciliationId" from-field="parameters.glReconciliationId"/> 
                <set field="finAccountTransId" from-field="parameters.finAccountTransId"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNTTX_EDIT"/>
                </service>
                <set field="hasFinTxEditPermission" from-field="permResult.hasPermission"/> 
            </actions>
            <widgets>
               <!--   <decorator-screen name="CashierCommonDecorator" location="component://accounting/widget/CommonScreens.xml"> -->
                    <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
             <!--    <decorator-screen name="CommonFinAccountDecorator" location="${parameters.finAccountDecoratorLocation}"> -->
                    <decorator-section name="body">
                        <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <condition>
                            	<if-service-permission service-name="acctgFinAcctPermissionCheck"  main-action="FINACCOUNTREC_EDIT"> </if-service-permission>
                                <if-compare field="finAccount.finAccountTypeId" operator="equals" value="BANK_ACCOUNT" type="String"></if-compare>
                            </condition>
                            <widgets>
                              <!--   <link target="FinancialAccountReconciliation" text="${uiLabelMap.FinAccountReconciliation}" style="buttontext">
                                    <parameter param-name="finAccountId" from-field="finAccountId"/>
                                    <parameter param-name="statusId" value="FINACT_TRNS_CREATED"/>
                                </link> -->
                            </widgets>
                        </section>
                        <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                             <decorator-section name="search-options" >
                                 <include-form name="FinAccountTransForReconsile"  share-scope="false" location="component://accounting/widget/TreasurerPortalForms.xml"/> 
                            </decorator-section>  
                            <decorator-section name="search-results">
                           <container>
                            <link target="FinAccountTransForReconsile.csv" text="Export as CSV" style="buttontext">
                                    <parameter param-name="finAccountId" from-field="finAccountId"/>
                                    <parameter param-name="finAccountTransType" from-field="parameters.finAccountTransTypeId"/>
                                    <parameter param-name="statusId" value="FINACT_TRNS_CREATED"/>
                                     <parameter param-name="fromTransactionDate" from-field="parameters.fromTransactionDate"/>
                                      <parameter param-name="thruTransactionDate" from-field="parameters.thruTransactionDate"/>
                                       <parameter param-name="glReconciliationId" value="_NA_" />
				                       <parameter param-name="subTabItem" value="FinAccountTransForReconsile" />
                                </link>
                            </container>
                                <platform-specific>
                                    <html><html-template location="component://accounting/webapp/accounting/finaccounttrans/FinAccountTransReconcile.ftl"/></html>
                                </platform-specific>
                            </decorator-section>
                        </decorator-screen>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    
      <screen name="PaymentsDepositWithdraw">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingDepositOrWithdrawPaymentsBANK"/>
                 <set field="parameters.findPaymentMethodType" value="bankOrNonBankMethodType"/>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                 <set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/>
                <set field="tabButtonItem2" value="depositWithdraw"/>
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <set field="paymentMethodTypeId" from-field="parameters.paymentMethodTypeId"/>
                <set field="cardType" from-field="parameters.cardType"/>
                <set field="fromDate" type="Timestamp" from-field="parameters.fromDate"/>
                <set field="thruDate" type="Timestamp" from-field="parameters.thruDate"/>
                <set field="partyIdFrom" from-field="parameters.partyIdFrom"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId"/>
                 <set field="issuingAuthority" from-field="parameters.issuingAuthority"/>
                 <set field="screenFlag" value="BankersDepositOrWithdraw"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNTDW_EDIT"/>
                </service>
                <set field="hasFinDwEditPermission" from-field="permResult.hasPermission"/> 
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/payment/DepositWithdrawPayments.groovy"/>
            </actions>
            <widgets>
              <!--   <decorator-screen name="CommonFinAccountDecorator" location="${parameters.finAccountDecoratorLocation}"> -->
                 <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                     <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<section>
                    		<condition>
                    			<if-service-permission service-name="acctgFinAcctPermissionCheck" main-action="FINACCOUNTDW_EDIT"/>
                    			</condition>
                    		<widgets>
                    			<container style="button-bar">
                                   <!--  <link target="NewDepositPayment" text="${uiLabelMap.AccountingCreateNewDepositPayment}" style="buttontext">
                                        <parameter param-name="finAccountId"/>
                                    </link>
                                    <link target="NewWithdrawalPayment" text="${uiLabelMap.AccountingCreateNewWithdrawalPayment}" style="buttontext">
                                        <parameter param-name="finAccountId"/>
                                    </link> -->
                                </container>
                               </widgets>
                    		</section>
                        <section>
                            <widgets>
                             <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="search-options">
                                        <include-form name="PaymentsDepositWithdraw" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section> 
                                    <decorator-section name="search-results">
                                        <platform-specific>
                                            <html><html-template location="component://accounting/webapp/accounting/payment/depositWithdrawPayments.ftl"/></html>
                                        </platform-specific>
                                    </decorator-section>
                                </decorator-screen>  
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="FindFinAccountReconciliationsNew">
        <section>
            <actions>
                <set field="titleProperty" value="FindBankAccountReconciliationsTitle"/>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/dateFindConvert.groovy"/>
                 <set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/>
                <set field="tabButtonItem2" value="FindFinAccountReconciliations"/>
                <set field="reconciledDateStart" value="${parameters.reconciledDateStart}"/>
                <set field="reconciledDateEnd" value="${parameters.reconciledDateEnd}"/>
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <set field="glReconciliationId" from-field="parameters.glReconciliationId" default-value=""/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNTREC_EDIT"/>
                </service>
                <set field="targetReuest" value="FindFinAccountReconciliationsNew"/>
                <set field="hasFinRecEditPermission" from-field="permResult.hasPermission"/>
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <entity-condition entity-name="FinAccountTrans" list="finAccountTransList">
                    <condition-list>
                        <condition-expr field-name="finAccountId" operator="equals" from-field="finAccountId"/>
                        <condition-expr field-name="glReconciliationId" operator="not-equals" from-field="nullField" ignore-if-empty="true"/>
                        <condition-expr field-name="glReconciliationId" operator="equals" from-field="glReconciliationId" ignore-if-empty="true"/>
                    </condition-list>
                </entity-condition>
                <set field="glReconciliationIds" value="${groovy:org.ofbiz.entity.util.EntityUtil.getFieldListFromEntityList(finAccountTransList, 'glReconciliationId', true);}" type="List"/>
                <entity-condition entity-name="GlReconciliation" list="glReconciliations">
                    <condition-list>
                        <condition-expr field-name="glReconciliationId" operator="in" from-field="glReconciliationIds"/>
                        <condition-expr field-name="glAccountId" operator="equals" from-field="finAccount.postToGlAccountId" ignore-if-empty="true"/>
                        <condition-expr field-name="glReconciliationName" operator="equals" from-field="parameters.glReconciliationName" ignore-if-empty="true"/>
                        <condition-expr field-name="description" operator="equals" from-field="parameters.description" ignore-if-empty="true"/>
                        <condition-expr field-name="statusId" operator="equals" from-field="parameters.statusId" ignore-if-empty="true"/>
                        <condition-expr field-name="organizationPartyId" operator="equals" from-field="parameters.organizationPartyId" ignore-if-empty="true"/>
                        <condition-expr  field-name="reconciledDate" operator="greater-equals"  from-field="reconciledDateStart"  ignore-if-empty="true" />
                        <condition-expr field-name="reconciledDate" operator="less-equals" from-field="reconciledDateEnd"  ignore-if-empty="true"/>
                    </condition-list>
                </entity-condition>
            </actions>
            <widgets>
                  <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                     <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                      <!--   <include-menu name="FinAccountReconciliationsTabBar" location="component://accounting/widget/AccountingMenus.xml"/> -->
                        <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                            <decorator-section name="search-options">
                                <include-form name="FindFinancialAccountReconciliation" location="component://accounting/widget/FinAccountForms.xml"/>
                            </decorator-section> 
                            <decorator-section name="search-results">
                                <include-form name="ListFinAccountReconciliations" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                            </decorator-section>
                        </decorator-screen>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="FinancialAccountingTransBANK">
		<section>
			<actions>
				<entity-one value-field="Name" entity-name="PartyGroup">
					<field-map field-name="partyId" value="${parameters.organizationPartyId}"/>
					<select-field field-name="groupName"/>
				</entity-one>
				<set field="titleProperty" value="FinancialAccountingTrans" />
				<set field="labelTitleProperty" value="Financial Accounting Trans" />
			    <set field="tabButtonItem" value="BankBook" />
				<set field="tabButtonItem2" value="FinancialAccountingTrans" />
				<set field="organizationPartyId" from-field="parameters.organizationPartyId" />
				<set field="parameters.screenFlag" value="TreasurerPortal" />
				<service service-name="basicGeneralLedgerPermissionCheck"
					result-map="permResult">
					<field-map field-name="mainAction" value="REPORTS" />
				</service>
				<set field="layoutSettings.javaScripts[]" value="/accounting/images/cashBook.js" global="true"/>
				<set field="hasReportsEditPermission" from-field="permResult.hasPermission" />
				<set field="formTargetRequest"    value="FinancialAccountingTransBANK" />
				<set field="reportTypeFlag" value="bankBook"/>
			</actions>
			<widgets>
				<section>
					<condition>
						<if-compare operator="equals" value="true"
							field="hasReportsEditPermission" />
					</condition>
					<widgets>
					 <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
						<!--   <decorator-screen name="CashierCommonDecorator" location="component://accounting/widget/CommonScreens.xml"> -->
							<decorator-section name="body">
							<include-screen name="FinancialAccountingTransInner" location="component://accounting/widget/ReportFinancialSummaryScreens.xml"/>
							</decorator-section>
						</decorator-screen>
					</widgets>
					<fail-widgets>
						<decorator-screen name="main-decorator"
							location="${parameters.mainDecoratorLocation}">
							<decorator-section name="body">
								<label style="h3" text="${uiLabelMap.AccountingReportError}"></label>
							</decorator-section>
						</decorator-screen>
					</fail-widgets>
				</section>
			</widgets>
		</section>
	</screen>
    
    <!-- ==================================== Incoming Advances  ===================================   -->
    <screen name="IncomingAdvancesReceived">
        <section>
            <actions>
                <set field="titleProperty" value="Incoming Advance Receipts"/>
                <set field="tabButtonItem" value="IncomingAdvances"/>
                <set field="tabButtonItem4" value="IncomingAdvancesReceived"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="1000"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="performFind" result-map="result">
	                <field-map field-name="inputFields" from-field="parameters"/>
	                <field-map field-name="entityName" value="PaymentAndType"/>
	                <field-map field-name="orderBy" value="effectiveDate DESC"/>
	                <field-map field-name="viewIndex" from-field="viewIndex"/>
	                <field-map field-name="viewSize" from-field="viewSize"/>
	            </service>
	            <set field="payments" from-field="result.listIt"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="IncomingAdvancesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                                    		<condition>
                                    		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                                    		</condition>
                                    		<widgets>
                                             <container style="button-bar">
                                            <link target="NewIncomingAdvanceReceived" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/>
                                        </container>
                                        </widgets>
                                    </section>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindIncomingAdvancesReceived" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/ListSearchAdvancesAndDeposits.ftl"/></html>
                                       	</platform-specific>
                                        <!-- <include-form name="ListPayments"  location="component://accounting/widget/PaymentForms.xml"/> -->
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewIncomingAdvanceReceived">
       <section>
            <actions>
                <set field="titleProperty" value="New Advance Receipt"/>
                <set field="tabButtonItem" value="IncomingAdvances"/>
                <set field="tabButtonItem4" value="IncomingAdvancesReceived"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="parameters.findPaymentMethodType" value="bankOrNonBankMethodType"/>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/findPaymentMethodType.groovy"/>
               	<set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentMethodType.js" global="true"/>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="IncomingAdvancesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                        	<condition>
                        		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                        	</condition>
                            <widgets>
                                <screenlet title="New Incoming Deposit">
                                    <include-form name="NewIncomingAdvanceReceipt" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newPaymentScreenError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    
    <screen name="IncomingAdvancesRefund">
        <section>
            <actions>
                <set field="titleProperty" value="Incoming Advance Receipts"/>
                <set field="tabButtonItem" value="IncomingAdvances"/>
                <set field="tabButtonItem4" value="IncomingAdvancesRefund"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="1000"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="performFind" result-map="result">
	                <field-map field-name="inputFields" from-field="parameters"/>
	                <field-map field-name="entityName" value="PaymentAndType"/>
	                <field-map field-name="orderBy" value="effectiveDate DESC"/>
	                <field-map field-name="viewIndex" from-field="viewIndex"/>
	                <field-map field-name="viewSize" from-field="viewSize"/>
	            </service>
	            <set field="payments" from-field="result.listIt"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="IncomingAdvancesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                                    		<condition>
                                    		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                                    		</condition>
                                    		<widgets>
                                             <container style="button-bar">
                                            <link target="NewIncomingAdvancesRefund" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/>
                                        </container>
                                        </widgets>
                                    </section>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindIncomingAdvancesRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/ListSearchAdvancesAndDeposits.ftl"/></html>
                                       	</platform-specific>
                                        <!-- <include-form name="ListPayments"  location="component://accounting/widget/PaymentForms.xml"/> -->
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewIncomingAdvancesRefund">
       <section>
            <actions>
                <set field="titleProperty" value="New Advance Refund"/>
                <set field="tabButtonItem" value="IncomingAdvances"/>
                <set field="tabButtonItem4" value="IncomingAdvancesRefund"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <!-- <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentMethod.js" global="true"/> -->
                <set field="searchParentType" value="ADVANCES_PAYIN"/>
                <set field="refundParentType" value="REFUND_PAYOUT"/>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/GetPaymentsForParty.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="IncomingAdvancesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                        	<condition>
                        		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                        	</condition>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="search-options">
                                        <include-form name="NewIncomingAdvancesRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/PaymentRefunds.ftl"/></html>
                                       	</platform-specific>
                                    	<screenlet title="Possible Payments To Refund">
                                            <include-form name="listPaymentsNotApplied" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                        </screenlet>
                                    </decorator-section>
                                    
                                </decorator-screen>
                                
                                <!-- <screenlet title="New Incoming Advance">
                                    <include-form name="NewIncomingAdvancesRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet> -->
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newPaymentScreenError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
       <!-- <screen name="BankContraEntry">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleBankContraTrans" />
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                <set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/>
                <set field="tabButtonItem" value="ContraEntry"/>
                
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <set field="finAccountTransTypeId" from-field="parameters.finAccountTransTypeId"/>
                <set field="entryType" from-field="parameters.entryType"/>
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentTransaction.js" global="true"/>
                <set field="finAccountTransId" from-field="parameters.finAccountTransId"/>
            </actions>
            <widgets>
              <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                <decorator-screen name="CommonFinAccountDecorator" location="${parameters.finAccountDecoratorLocation}">
                    <decorator-section name="body">
                       <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <label style="h1" text="${uiLabelMap.PageTitleBankContraTrans}"/>
                        <screenlet id="FinAccountTransPanel" collapsible="true">
                            <include-form name="BankContraEntry" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen> -->
    
    <screen name="BankContraEntry">
        <section>
             <actions>
                <set field="titleProperty" value="PageTitleBankContraTrans" />
               <!--   <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                <set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/> -->
                <set field="tabButtonItem" value="ContraEntry"/>
                <set field="tabButtonItem4" value="BankContraEntry"/>
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <set field="finAccountTransTypeId" from-field="parameters.finAccountTransTypeId"/>
                <set field="entryType" from-field="parameters.entryType"/>
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentTransaction.js" global="true"/>
                <set field="finAccountTransId" from-field="parameters.finAccountTransId"/>
            </actions>           
            <widgets>
            <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    <include-menu name="ContraEntryTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<section>
							<widgets>
								<container style="button-bar">
									<link target="CreateNewContra" text="Create Contra" style="buttontext create">				
									</link>
								</container>
								<screenlet title="Find Contra Entries">				
									<include-form name="FindContraEntries" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
								<screenlet title="List Contra Entries">				
									<include-form name="ListContraEntries" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
							</widgets>      
                    	</section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="CreateNewContra">
        <section>
            <actions>
			   <set field="titleProperty" value="PageTitleBankContraTrans" />
               <!--   <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                <set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/> -->
                <set field="tabButtonItem" value="ContraEntry"/>
                <set field="tabButtonItem4" value="BankContraEntry"/>
                
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <set field="finAccountTransTypeId" from-field="parameters.finAccountTransTypeId"/>
                <set field="entryType" from-field="parameters.entryType"/>
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentTransaction.js" global="true"/>
                <set field="finAccountTransId" from-field="parameters.finAccountTransId"/>
            </actions>           
            <widgets>
            <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    <include-menu name="ContraEntryTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<section>
							<widgets>
								<screenlet title="Create Contra Entry">				
									<include-form name="BankContraEntry" location="component://accounting/widget/TreasurerPortalForms.xml"/>
								</screenlet>
							</widgets>      
                    	</section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- ==================================== Outgoing Advances  ===================================   -->
    
    <screen name="OutgoingAdvancesRefund">
        <section>
            <actions>
                <set field="titleProperty" value="Outgoing Advance Refund"/>
                <set field="tabButtonItem" value="OutgoingAdvances"/>
                <set field="tabButtonItem4" value="OutgoingAdvancesRefund"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="1000"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="performFind" result-map="result">
	                <field-map field-name="inputFields" from-field="parameters"/>
	                <field-map field-name="entityName" value="PaymentAndType"/>
	                <field-map field-name="orderBy" value="effectiveDate DESC"/>
	                <field-map field-name="viewIndex" from-field="viewIndex"/>
	                <field-map field-name="viewSize" from-field="viewSize"/>
	            </service>
	            <set field="payments" from-field="result.listIt"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="OutgoingAdvancesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                                    		<condition>
                                    		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                                    		</condition>
                                    		<widgets>
                                             <container style="button-bar">
                                            <link target="NewOutgoingAdvancesRefund" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/>
                                        </container>
                                        </widgets>
                                    </section>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindOutgoingAdvancesRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/ListSearchAdvancesAndDeposits.ftl"/></html>
                                       	</platform-specific>
                                        <!-- <include-form name="ListPayments"  location="component://accounting/widget/PaymentForms.xml"/> -->
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewOutgoingAdvancesRefund">
       <section>
            <actions>
                <set field="titleProperty" value="New Advance Refund"/>
                <set field="tabButtonItem" value="OutgoingAdvances"/>
                <set field="tabButtonItem4" value="OutgoingAdvancesRefund"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
               	<!-- <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentMethodType.js" global="true"/> -->
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <set field="searchParentType" value="ADVANCES_PAYOUT"/>
                <set field="refundParentType" value="REFUND_PAYIN"/>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/GetPaymentsForParty.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                	
                	<decorator-section name="body">
                    	<include-menu name="OutgoingAdvancesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                        	<condition>
                        		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                        	</condition>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="search-options">
                                        <include-form name="NewOutgoingAdvanceRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/PaymentRefunds.ftl"/></html>
                                       	</platform-specific>
                                    	<screenlet title="Possible Payments To Refund">
                                            <include-form name="listAPPaymentsNotApplied" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                        </screenlet>
                                    </decorator-section>
                                </decorator-screen>
                                
                                <!-- <screenlet title="New Incoming Advance">
                                    <include-form name="NewIncomingAdvancesRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet> -->
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newPaymentScreenError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    
    <screen name="OutgoingAdvancesPaid">
        <section>
            <actions>
                <set field="titleProperty" value="Outgoing Advance Receipts"/>
                <set field="tabButtonItem" value="OutgoingAdvances"/>
                <set field="tabButtonItem4" value="OutgoingAdvancesPaid"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="1000"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="performFind" result-map="result">
	                <field-map field-name="inputFields" from-field="parameters"/>
	                <field-map field-name="entityName" value="PaymentAndType"/>
	                <field-map field-name="orderBy" value="effectiveDate DESC"/>
	                <field-map field-name="viewIndex" from-field="viewIndex"/>
	                <field-map field-name="viewSize" from-field="viewSize"/>
	            </service>
	            <set field="payments" from-field="result.listIt"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="OutgoingAdvancesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                                    		<condition>
                                    		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                                    		</condition>
                                    		<widgets>
                                             <container style="button-bar">
                                            <link target="NewOutgoingAdvancePaid" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/>
                                        </container>
                                        </widgets>
                                    </section>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindOutgoingAdvancesPaid" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/ListSearchAdvancesAndDeposits.ftl"/></html>
                                       	</platform-specific>
                                        <!-- <include-form name="ListPayments"  location="component://accounting/widget/PaymentForms.xml"/> -->
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewOutgoingAdvancePaid">
       <section>
            <actions>
                <set field="titleProperty" value="New Advance Payment"/>
                <set field="tabButtonItem" value="OutgoingAdvances"/>
                <set field="tabButtonItem4" value="OutgoingAdvancesPaid"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentMethod.js" global="true"/>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="OutgoingAdvancesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                        	<condition>
                        		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                        	</condition>
                            <widgets>
                                <screenlet title="New Incoming Advance">
                                    <include-form name="NewOutgoingAdvancesPaid" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newPaymentScreenError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="PaymentOverview">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitlePaymentOverview"/>
                <set field="tabButtonItem" value="PaymentOverview"/>
                <set field="labelTitleProperty" value="PageTitlePaymentOverview"/>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="paymentId" from-field="parameters.paymentId"/>
                <entity-one entity-name="Payment" value-field="payment"/>
                <set field="finAccountTransId" from-field="payment.finAccountTransId"/>
                <entity-one entity-name="FinAccountTrans" value-field="finAccountTrans"/>
                <set field="appliedAmount" value="${bsh:org.ofbiz.accounting.payment.PaymentWorker.getPaymentApplied(payment).toString()}"/>
                <set field="notAppliedAmount" value="${bsh:org.ofbiz.accounting.payment.PaymentWorker.getPaymentNotApplied(payment).toString()}"/>
                <entity-condition entity-name="AcctgTransAndEntries" list="AcctgTransAndEntries">
                    <condition-expr field-name="paymentId" from-field="paymentId"/>
                    <order-by field-name="acctgTransId"/>
                    <order-by field-name="acctgTransEntrySeqId"/>
                </entity-condition>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
               <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
               <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENTAPP_EDIT"/>
                </service>
               <set field="hasPaymentAppEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENTSTATUS_CANCEL"/>
                </service>
               <set field="hasPaymentStatusCancelPermission" from-field="permResult.hasPermission"/>
               <script location="component://accounting/webapp/accounting/WEB-INF/actions/PaymentAttributeInfo.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPaymentPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-compare field="payment.statusId" operator="equals"  value="PMNT_NOT_PAID"/>
                            </condition>
                            <widgets>
                                  <platform-specific>
                                <html><html-template location="component://accounting/webapp/accounting/payment/setPaymentStatus.ftl"/></html>
                            </platform-specific>
                                <container style="lefthalf">
                                    <screenlet title="${uiLabelMap.AccountingPaymentHeader}">
                                        <link target="editPayment" text="ad${uiLabelMap.CommonUpdate}" style="buttontext">
                                            <parameter param-name="paymentId"/>
                                        </link>
                                        <include-form name="paymentHeader" location="component://accounting/widget/PaymentForms.xml"/>
                                    </screenlet>
                                </container>
                                <container style="righthalf">
                                    <screenlet title="${uiLabelMap.AccountingPaymentsApplied} ${appliedAmount?currency(${payment.currencyUomId})} ${uiLabelMap.AccountingOpenPayments} ${notAppliedAmount?currency(${payment.currencyUomId})}">
                                        <link target="editPaymentApplications" text="${uiLabelMap.CommonUpdate}" style="buttontext">
                                            <parameter param-name="paymentId"/>
                                        </link>
                                        <include-form name="paymentApplications" location="component://accounting/widget/PaymentForms.xml"/>
                                    </screenlet>
                                    <section>
                                        <condition>
                                            <not><if-empty field="finAccountTransId"/></not>
                                        </condition>
                                        <widgets>
                                            <screenlet title="${uiLabelMap.AccountingFinAccountTransaction}">
                                                <include-form name="FinAccountTransAssociatedWithPayment" location="component://accounting/widget/PaymentForms.xml"/>
                                            </screenlet>
                                        </widgets>
                                    </section>
                                </container>
                                <container style="clear"/>
                                <screenlet title="${uiLabelMap.AccountingTransactions}" navigation-form-name="AcctgTransAndEntries">
                                    <include-form name="AcctgTransAndEntries" location="component://accounting/widget/PaymentForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <container style="lefthalf">
                                    <screenlet title="${uiLabelMap.AccountingPaymentHeader}">
                                        <include-form name="paymentHeader" location="component://accounting/widget/PaymentForms.xml"/>
                                    </screenlet>
                                </container>
                                <container style="righthalf">
                                    <screenlet title="${uiLabelMap.AccountingPaymentsApplied} ${appliedAmount?currency(${payment.currencyUomId})} ${uiLabelMap.AccountingOpenPayments} ${notAppliedAmount?currency(${payment.currencyUomId})}">
                                        <include-form name="paymentApplications" location="component://accounting/widget/PaymentForms.xml"/>
                                    </screenlet>
                                        <section>
                                            <condition>
                                                <not><if-empty field="finAccountTransId"/></not>
                                            </condition>
                                            <widgets>
                                                <screenlet title="${uiLabelMap.AccountingFinAccountTransaction}">
                                                    <include-form name="FinAccountTransAssociatedWithPayment" location="component://accounting/widget/PaymentForms.xml"/>
                                                </screenlet>
                                            </widgets>
                                        </section>
                                </container>
                                <container style="clear"/>
                                <screenlet title="${uiLabelMap.AccountingTransactions}" navigation-form-name="AcctgTransAndEntries">
                                    <include-form name="AcctgTransAndEntries" location="component://accounting/widget/PaymentForms.xml"/>
                                </screenlet>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <!-- ==================================== Incoming Deposits  ===================================   -->
    <screen name="IncomingDepositsReceived">
        <section>
            <actions>
                <set field="titleProperty" value="Incoming Deposits Receipts"/>
                <set field="tabButtonItem" value="IncomingDeposits"/>
                <set field="tabButtonItem4" value="IncomingDepositsReceived"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="1000"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="performFind" result-map="result">
	                <field-map field-name="inputFields" from-field="parameters"/>
	                <field-map field-name="entityName" value="PaymentAndType"/>
	                <field-map field-name="orderBy" value="effectiveDate DESC"/>
	                <field-map field-name="viewIndex" from-field="viewIndex"/>
	                <field-map field-name="viewSize" from-field="viewSize"/>
	            </service>
	            <set field="payments" from-field="result.listIt"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="IncomingDepositsTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                                    		<condition>
                                    		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                                    		</condition>
                                    		<widgets>
                                             <container style="button-bar">
                                            <link target="NewIncomingDepositsReceived" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/>
                                        </container>
                                        </widgets>
                                    </section>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindIncomingDepositsReceived" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/ListSearchAdvancesAndDeposits.ftl"/></html>
                                       	</platform-specific>
                                        <!-- <include-form name="ListPayments"  location="component://accounting/widget/PaymentForms.xml"/> -->
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewIncomingDepositsReceived">
       <section>
            <actions>
                <set field="titleProperty" value="New Deposits Receipt"/>
                <set field="tabButtonItem" value="IncomingDeposits"/>
                <set field="tabButtonItem4" value="IncomingDepositsReceived"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                 <set field="parameters.findPaymentMethodType" value="bankOrNonBankMethodType"/>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/findPaymentMethodType.groovy"/>
               	<set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentMethodType.js" global="true"/>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="IncomingDepositsTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                        	<condition>
                        		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                        	</condition>
                            <widgets>
                                <screenlet title="New Incoming Deposits">
                                    <include-form name="NewIncomingDepositsReceipt" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newPaymentScreenError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    
    <screen name="IncomingDepositsRefund">
        <section>
            <actions>
                <set field="titleProperty" value="Incoming Deposits Receipts"/>
                <set field="tabButtonItem" value="IncomingDeposits"/>
                <set field="tabButtonItem4" value="IncomingDepositsRefund"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="1000"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="performFind" result-map="result">
	                <field-map field-name="inputFields" from-field="parameters"/>
	                <field-map field-name="entityName" value="PaymentAndType"/>
	                <field-map field-name="orderBy" value="effectiveDate DESC"/>
	                <field-map field-name="viewIndex" from-field="viewIndex"/>
	                <field-map field-name="viewSize" from-field="viewSize"/>
	            </service>
	            <set field="payments" from-field="result.listIt"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="IncomingDepositsTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                                    		<condition>
                                    		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                                    		</condition>
                                    		<widgets>
                                             <container style="button-bar">
                                            <link target="NewIncomingDepositsRefund" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/>
                                        </container>
                                        </widgets>
                                    </section>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindIncomingDepositsRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/ListSearchAdvancesAndDeposits.ftl"/></html>
                                       	</platform-specific>
                                        <!-- <include-form name="ListPayments"  location="component://accounting/widget/PaymentForms.xml"/> -->
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewIncomingDepositsRefund">
       <section>
            <actions>
                <set field="titleProperty" value="New Deposits Refund"/>
                <set field="tabButtonItem" value="IncomingDeposits"/>
                <set field="tabButtonItem4" value="IncomingDepositsRefund"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentMethod.js" global="true"/>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="IncomingDepositsTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                        	<condition>
                        		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                        	</condition>
                            <widgets>
                                <screenlet title="New Incoming Deposits">
                                    <include-form name="NewIncomingDepositsRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newPaymentScreenError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- ==================================== Outgoing Deposits  ===================================   -->
    
    <screen name="OutgoingDepositsRefund">
        <section>
            <actions>
                <set field="titleProperty" value="Outgoing Deposits Refund"/>
                <set field="tabButtonItem" value="OutgoingDeposits"/>
                <set field="tabButtonItem4" value="OutgoingDepositsRefund"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="1000"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="performFind" result-map="result">
	                <field-map field-name="inputFields" from-field="parameters"/>
	                <field-map field-name="entityName" value="PaymentAndType"/>
	                <field-map field-name="orderBy" value="effectiveDate DESC"/>
	                <field-map field-name="viewIndex" from-field="viewIndex"/>
	                <field-map field-name="viewSize" from-field="viewSize"/>
	            </service>
	            <set field="payments" from-field="result.listIt"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="OutgoingDepositsTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                                    		<condition>
                                    		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                                    		</condition>
                                    		<widgets>
                                             <container style="button-bar">
                                            <link target="NewOutgoingDepositsRefund" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/>
                                        </container>
                                        </widgets>
                                    </section>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindOutgoingDepositsRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/ListSearchAdvancesAndDeposits.ftl"/></html>
                                       	</platform-specific>
                                        <!-- <include-form name="ListPayments"  location="component://accounting/widget/PaymentForms.xml"/> -->
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewOutgoingDepositsRefund">
       <section>
            <actions>
                <set field="titleProperty" value="New Deposits Refund"/>
                <set field="tabButtonItem" value="OutgoingDeposits"/>
                <set field="tabButtonItem4" value="OutgoingDepositsRefund"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
               	<set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentMethodType.js" global="true"/>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="OutgoingDepositsTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                        	<condition>
                        		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                        	</condition>
                            <widgets>
                                <screenlet title="New Incoming Deposit">
                                    <include-form name="NewOutgoingDepositsRefund" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newPaymentScreenError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    
    <screen name="OutgoingDepositsPaid">
        <section>
            <actions>
                <set field="titleProperty" value="Incoming Deposits Receipts"/>
                <set field="tabButtonItem" value="OutgoingDeposits"/>
                <set field="tabButtonItem4" value="OutgoingDepositsPaid"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="1000"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
                <service service-name="performFind" result-map="result">
	                <field-map field-name="inputFields" from-field="parameters"/>
	                <field-map field-name="entityName" value="PaymentAndType"/>
	                <field-map field-name="orderBy" value="effectiveDate DESC"/>
	                <field-map field-name="viewIndex" from-field="viewIndex"/>
	                <field-map field-name="viewSize" from-field="viewSize"/>
	            </service>
	            <set field="payments" from-field="result.listIt"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="OutgoingDepositsTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                                    		<condition>
                                    		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                                    		</condition>
                                    		<widgets>
                                             <container style="button-bar">
                                            <link target="NewOutgoingDepositsPaid" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/>
                                        </container>
                                        </widgets>
                                    </section>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindOutgoingDepositsPaid" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                    	<platform-specific>
                                           	<html><html-template location="component://accounting/webapp/accounting/payment/ListSearchAdvancesAndDeposits.ftl"/></html>
                                       	</platform-specific>
                                        <!-- <include-form name="ListPayments"  location="component://accounting/widget/PaymentForms.xml"/> -->
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewOutgoingDepositsPaid">
       <section>
            <actions>
                <set field="titleProperty" value="New Deposits Refund"/>
                <set field="tabButtonItem" value="OutgoingDeposits"/>
                <set field="tabButtonItem4" value="OutgoingDepositsPaid"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="PAYMENT_EDIT"/>
                </service>
                <set field="layoutSettings.javaScripts[]" value="/accounting/images/paymentMethod.js" global="true"/>
                <set field="hasPaymentEditPermission" from-field="permResult.hasPermission"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="OutgoingDepositsTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                        	<condition>
                        		<if-compare operator="equals" value="true" field="hasPaymentEditPermission"/>
                        	</condition>
                            <widgets>
                                <screenlet title="New Incoming Deposits">
                                    <include-form name="NewOutgoingDepositsPaid" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newPaymentScreenError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="RecStatement">
		<section>
			<actions>
                <set field="titleProperty" value="CreateBankAccountReconciliationsTitle"/>
                <!--   <set field="tabButtonItem" value="FindFinAccountAlt"/> -->
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/dateFindConvert.groovy"/>
                <set field="parameters.glReconciliationId" value="${glReconciliationId}"/><!-- instead of Form we are setting in Screen  -->
               <!--  <set field="parameters.finAccountId" value="${parameters.finAccountId}"/> -->
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                 <set field="parameters.statusId" value="FINACT_TRNS_CREATED"/>
                 <set field="fromTransactionDate" value="${parameters.fromDateReport}"/>
                  <set field="thruTransactionDate" value="${parameters.thruDateReport}"/>
                 <set field="glReconciliationId" value="${glReconciliationId}"/>
                 <set field="parameters.noConditionFind" value="Y"/>                       
                <service service-name="getFinAccountTransListAndTotals" result-map="finAccountTransListAndTotals" auto-field-map="true"/>
                <set field="finAccountTransList" type="List" from-field="finAccountTransListAndTotals.finAccountTransList"/>
                <set field="searchedNumberOfRecords" type="Integer" from-field="finAccountTransListAndTotals.searchedNumberOfRecords"/>
                <set field="grandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.grandTotal"/>
                <set field="createdGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdGrandTotal"/>
                <set field="totalCreatedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedTransactions"/>
                <set field="approvedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.approvedGrandTotal"/>
                <set field="totalApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalApprovedTransactions"/>
                <set field="createdApprovedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdApprovedGrandTotal"/>
                <set field="totalCreatedApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedApprovedTransactions"/>
                 <set field="finAccountId" from-field="parameters.finAccountId"/> 
                <entity-one entity-name="FinAccount"  value-field="finAccount"/>
                <set field="glReconciliationId" from-field="parameters.glReconciliationId"/> 
                <set field="finAccountTransId" from-field="parameters.finAccountTransId"/>
                  <script location="component://accounting/webapp/accounting/WEB-INF/actions/finaccounttrans/FindFinAccountTrans.groovy"/>
            </actions>
			<widgets>
				<platform-specific> 
				  <xsl-fo><html-template location="component://accounting/webapp/accounting/finaccounttrans/ReconcilationStatement.fo.ftl"/></xsl-fo> 
                </platform-specific>
			</widgets>
		</section>
	</screen>
	
	<!-- ==================================== AP Invoices  ===================================   -->
	
	<screen name="FindApInvoices">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingFindApInvoices"/>
                <set field="filterByDate" value="true"/>
                <service service-name="performFind" result-map="result">
                    <field-map field-name="inputFields" from-field="parameters"/>
                    <field-map field-name="entityName" value="InvoiceAndType"/>
                    <field-map field-name="orderBy" value="invoiceDate DESC"/>
                </service>
                <set field="invoices" from-field="result.listIt"/>
                <set field="tabButtonItem" value="accountPayable"/>
                <set field="tabButtonItem5" value="${parameters.subTabButtonValue}"/>
                <set field="tabButtonItem2" value="${parameters.actionSubTabButtonValue}"/>
                <set field="invoiceTypeId"  value="${parameters.invoiceTypeId}"/>
           		 <script location="component://accounting/webapp/ap/WEB-INF/actions/invoices/voucherPaymentMethod.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="InvoiceTypesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<include-menu name="APInvoiceTabBar" location="component://accounting/widget/AccountingMenus.xml" />
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                        <container style="button-bar">
                                          <!--  <link target="newInvoice" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/> --> <!--  NewPurchaseInvoice-->
                                            <!-- <link target="newInvoice" text="New Cash Voucher" style="buttontext create"><parameter param-name="prefPaymentMethodTypeId" value="CASH"/></link>
                                            <link target="newInvoice" text="New Bank Voucher" style="buttontext create"><parameter param-name="prefPaymentMethodTypeId" value="BANK"/></link>
                                            <link target="partyFinanHistory" text="Party Financial History" style="buttontext create"></link> -->
                                            <link target="CreateAPInvoice" text="Create Cash Voucher" style="buttontext create" > 
                                            	<parameter param-name="prefPaymentMethodTypeId" value="CASH"></parameter>
                                            	<parameter param-name="subTabButtonValue" value="${parameters.subTabButtonValue}"></parameter>
                                            	<parameter param-name="invoiceTypeId" value="${parameters.invoiceTypeId}"></parameter>
                                            	<parameter param-name="showCreateButton" value="Y"></parameter>
                                            </link>
                                        	<link target="CreateAPInvoice" text="Create Bank Voucher" style="buttontext create" >
                                        		<parameter param-name="prefPaymentMethodTypeId" value="BANK"></parameter>
                                        		<parameter param-name="subTabButtonValue" value="${parameters.subTabButtonValue}"></parameter>
                                        		<parameter param-name="invoiceTypeId" value="${parameters.invoiceTypeId}"></parameter>
                                        		<parameter param-name="showCreateButton" value="Y"></parameter>
                                        	</link>
                                        	<link target="partyFinanHistory" text="Party Financial History" style="buttontext create"></link>
                                        </container>
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindApInvoices" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
            							<screenlet title="Invoices List">  
            								<section>   
            									<condition>
            										<not><if-empty field="invoices" /></not>
            									</condition>
            									<widgets>                        
		            								<link text="${uiLabelMap.AccountingExportAsCsv}" style="buttontext"
														target="InvoiceSearchResultsCsv.csv">
														<parameter param-name="parentTypeId" from-field="parameters.parentTypeId"/>
														<parameter param-name="invoiceId_op" from-field="parameters.invoiceId_op"/>
														<parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
														<parameter param-name="invoiceId_ic" from-field="parameters.invoiceId_ic"/>
														<parameter param-name="description_op" from-field="parameters.description_op"/>
														<parameter param-name="description" from-field="parameters.description"/>
														<parameter param-name="description_ic" from-field="parameters.description_ic"/>
														<parameter param-name="invoiceTypeId" from-field="parameters.invoiceTypeId"/>
														<parameter param-name="statusId" from-field="parameters.statusId"/>
														<parameter param-name="partyIdFrom" from-field="parameters.partyIdFrom"/>
														<parameter param-name="partyId" from-field="parameters.partyId"/>
														<parameter param-name="invoiceDate_fld0_value" from-field="parameters.invoiceDate_fld0_value"/>
														<parameter param-name="invoiceDate_fld0_op" from-field="parameters.invoiceDate_fld0_op"/>
														<parameter param-name="invoiceDate_fld1_value" from-field="parameters.invoiceDate_fld1_value"/>
														<parameter param-name="invoiceDate_fld1_op" from-field="parameters.invoiceDate_fld1_op"/>
														<parameter param-name="dueDate_fld0_value" from-field="parameters.dueDate_fld0_value"/>
														<parameter param-name="dueDate_fld0_op" from-field="parameters.dueDate_fld0_op"/>
														<parameter param-name="dueDate_fld1_value" from-field="parameters.dueDate_fld1_value"/>
														<parameter param-name="dueDate_fld1_op" from-field="parameters.dueDate_fld1_op"/>
													</link>	                 
												</widgets>
											</section>
                                        	<platform-specific>
                                        	<html><html-template location="component://accounting/webapp/accounting/invoice/massPayments.ftl"/></html>
											</platform-specific>
											<platform-specific>
                                            	<html><html-template location="component://accounting/webapp/accounting/invoice/ListSearchInvoicesTreasurerPortal.ftl"/></html>
                                        	</platform-specific>
                                        </screenlet>
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
	<screen name="CreateAPInvoice">
        <section>
            <actions>
            	<set field="tabButtonItem" value="accountPayable"/>
                <set field="tabButtonItem5" value="${parameters.subTabButtonValue}"/>
            	<set field="tabButtonItem2" value="${parameters.actionSubTabButtonValue}" default-value="createInvoice"/>
            	<set field="invoiceTypeId"  value="${parameters.invoiceTypeId}"/>
				<set field="layoutSettings.javaScripts[]" value="/accounting/images/commonInvoice.js" global="true"/>                        
				<set field="layoutSettings.javaScripts[]" value="/accounting/images/payableInvoice.js" global="true"/>
                <set field="headerItem" value="invoices"/>
                <entity-one entity-name="Invoice" value-field="invoice"/>
                 <set field="prefPaymentMethodTypeId"  from-field="parameters.prefPaymentMethodTypeId"/>
                 <script location="component://accounting/webapp/ap/WEB-INF/actions/invoices/voucherPaymentMethod.groovy"/>
                 <set field="titleProperty" value="${invoiceCreateScreenTitle}"/>
                 <set field="prefPaymentMethodTypeId"  from-field="parameters.prefPaymentMethodTypeId"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="ARINVOICE_EDIT"/>
                </service>
                <set field="hasArInvoiceEditPermission" from-field="permResult.hasPermission"/>
                <entity-one entity-name="Invoice" value-field="invoice" />
				<entity-one entity-name="InvoiceItem" value-field="invoiceItem" />
				<entity-and entity-name="InvoiceItem" list="invoiceItems">
					<field-map field-name="invoiceId" from-field="parameters.invoiceId" />
					<order-by field-name="invoiceItemSeqId" />
				</entity-and>
				<script	location="component://accounting/webapp/accounting/WEB-INF/actions/invoice/GetInvoiceItemTypes.groovy" />
				<entity-condition entity-name="InvoiceItemType"	list="PayrolGroup">
					<condition-expr field-name="parentTypeId" value="PAYROL" />
				</entity-condition>
				<entity-condition entity-name="InvoiceItemType"	list="PayrolList"></entity-condition>
				<service service-name="acctgInvoicePermissionCheck"	result-map="permResult">
					<field-map field-name="mainAction" value="ARINVOICE_EDIT" />
				</service>
				<set field="invoiceId" value="${invoice.invoiceId}" />
				<set field="showCreateButton" value="${parameters.showCreateButton}" />
				<set field="showUpdateButton" value="${parameters.showUpdateButton}" />
            </actions>
            <widgets>
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="InvoiceTypesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<include-menu name="APInvoiceTabBar"
									location="component://accounting/widget/AccountingMenus.xml" />
						<!-- <include-menu name="CreateAPInvoiceSubTabBar"
									location="component://accounting/widget/AccountingMenus.xml" /> -->
                        <section>
                            <widgets>
                                <screenlet title="${invoiceCreateScreenTitle}">
                                    <include-form name="CreateAPInvoice" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                        </section>
                        <section>
							<condition>
								<and>
									<not><if-empty field="invoice" /></not>
									<if-compare field="invoice.statusId" operator="equals"	value="INVOICE_IN_PROCESS" />
									<if-compare field="invoice.invoiceTypeId" operator="not-equals"	value="PAYROL_INVOICE" />
									<or>
										<if-compare operator="equals" value="true" field="hasArInvoiceEditPermission" />
										<if-compare operator="equals" value="true" field="hasApInvoiceEditPermission" />
									</or>
								</and>
							</condition>
							<widgets>
											<platform-specific>
					                           	<html><html-template location="component://accounting/webapp/accounting/invoice/AddPurchaseInvoiceItems.ftl"/></html>
					                       	</platform-specific>
										</widgets>
						</section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
	<screen name="APInvoiceOverview">
		<section>
			<actions>
				<property-map resource="PartyUiLabels" map-name="uiLabelMap"
					global="true" />
				<set field="titleProperty" value="PageTitleInvoiceOverview" />
				<set field="tabButtonItem" value="accountPayable"/>
                <set field="tabButtonItem5" value="${parameters.subTabButtonValue}"/>
            	<set field="tabButtonItem2" value="invoiceOverview"/>
            	<set field="invoiceTypeId"  value="${parameters.invoiceTypeId}"/>
				<set field="invoiceId" from-field="parameters.invoiceId" />
				<entity-one entity-name="Invoice" value-field="invoice" />
				<entity-and entity-name="InvoiceRole" list="invoiceRoles">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="partyId" />
				</entity-and>
				<entity-and entity-name="InvoiceStatus" list="invoiceStatus">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="statusDate" />
				</entity-and>
				<entity-and entity-name="InvoiceTerm" list="invoiceTerms">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="invoiceTermId" />
				</entity-and>
				<entity-and entity-name="TimeEntry" list="timeEntries">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="invoiceItemSeqId" />
				</entity-and>
				<!-- <entity-and entity-name="PaymentApplication" list="paymentApplications">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="paymentApplicationId" />
				</entity-and> -->
				<entity-and entity-name="PaymentAndApplication" list="payment">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="paymentId" />
				</entity-and>
				<script
					location="component://accounting/webapp/accounting/WEB-INF/actions/invoice/CreateApplicationList.groovy" />
				<script
					location="component://accounting/webapp/accounting/WEB-INF/actions/invoice/OrderListInvoiceItem.groovy" />
				<set field="invoiceAmount"
					value="${bsh:org.ofbiz.accounting.invoice.InvoiceWorker.getInvoiceTotal(invoice)}"
					type="BigDecimal" />
				<set field="notAppliedAmount"
					value="${bsh:org.ofbiz.accounting.invoice.InvoiceWorker.getInvoiceNotApplied(invoice)}"
					type="BigDecimal" />
				<set field="appliedAmount"
					value="${bsh:org.ofbiz.accounting.invoice.InvoiceWorker.getInvoiceApplied(invoice)}"
					type="BigDecimal" />
				<entity-condition entity-name="AcctgTransAndEntries"
					list="AcctgTransAndEntries">
					<condition-expr field-name="invoiceId" operator="equals"
						from-field="invoiceId" />
					<order-by field-name="acctgTransId" />
				</entity-condition>
				<service service-name="acctgInvoicePermissionCheck"
					result-map="permResult">
					<field-map field-name="mainAction" value="ARINVOICE_EDIT" />
				</service>
				<set field="hasArInvoiceEditPermission" from-field="permResult.hasPermission" />
				<service service-name="acctgInvoicePermissionCheck"
					result-map="permResult">
					<field-map field-name="mainAction" value="INVOICE_APPROVE" />
				</service>
				<set field="hasApproveInvoiceEditPermission" from-field="permResult.hasPermission" />
				<service service-name="acctgInvoicePermissionCheck"
					result-map="permResult">
					<field-map field-name="mainAction" value="APINVOICE_EDIT" />
				</service>
				<set field="hasApInvoiceEditPermission" from-field="permResult.hasPermission" />
				<set field="localDispatcherName" value="${parameters.localDispatcherName}" />
				<set field="requestUri" value="${parameters.targetRequestUri}"/>
			</actions>
			<widgets>
				<decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
					<decorator-section name="body">
						<include-menu name="InvoiceTypesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<include-menu name="APInvoiceTabBar"
									location="component://accounting/widget/AccountingMenus.xml" />
						<include-menu name="CreateAPInvoiceSubTabBar"
									location="component://accounting/widget/AccountingMenus.xml" />
						<container style="h1"><label>For: ${invoice.description} [${invoice.invoiceId}]</label></container>			
						<section>
							<condition>
								<and>
									<if-compare field="invoice.statusId" operator="equals" value="INVOICE_IN_PROCESS" />
									<if-compare field="invoice.invoiceTypeId" operator="equals" value="PETTYCASH_INVOICE" />
									<if-compare field="requestUri" operator="equals" value="/createInvoice" />
								</and>
							</condition>
							<actions>
								<script
									location="component://accounting/webapp/accounting/WEB-INF/actions/invoice/GetInvoiceItemTypes.groovy" />
							</actions>
							<widgets>
							<screenlet title="${uiLabelMap.AccountingInvoiceItems}">
							<include-form name="EditInvoiceItems"
								location="component://accounting/widget/InvoiceForms.xml" />
						</screenlet>
						<section>
							<condition>
								<and>
									<if-compare field="invoice.invoiceTypeId" operator="not-equals"
										value="PAYROL_INVOICE" />
									<or>
										<if-compare operator="equals" value="true"
											field="hasArInvoiceEditPermission" />
										<if-compare operator="equals" value="true"
											field="hasApInvoiceEditPermission" />
									</or>
								</and>
							</condition>
							<widgets>
								<screenlet title="${uiLabelMap.AccountingInvoiceItemAdd}">
									<section>
										<widgets>
											<include-form name="EditInvoiceItem"
												location="component://accounting/widget/InvoiceForms.xml" />
										</widgets>
									</section>
								</screenlet>
							</widgets>
						</section>
							</widgets>
						<fail-widgets>
						<section>
							<condition>
								<and>
									<if-compare field="invoice.statusId" operator="equals"
										value="INVOICE_IN_PROCESS" />
									<or>
										<if-compare operator="equals" value="true"
											field="hasArInvoiceEditPermission" />
										<if-compare operator="equals" value="true"
											field="hasApInvoiceEditPermission" />
									</or>
								</and>
							</condition>
							<widgets>
								<screenlet title="${uiLabelMap.AccountingInvoiceHeader}">
									<link target="editInvoice" text="${uiLabelMap.CommonUpdate}"
										style="buttontext">
										<parameter param-name="invoiceId" />
									</link>
									<include-form name="invoiceHeader"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
								<container style="lefthalf">
									<screenlet title="${uiLabelMap.CommonStatus}"
										navigation-form-name="ListInvoiceStatus">
										<include-form name="ListInvoiceStatus"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<!-- <screenlet
										title="${uiLabelMap.AccountingAppliedPayments} ${appliedAmount?currency(${invoice.currencyUomId})} ${uiLabelMap.AccountingOpenPayments} ${notAppliedAmount?currency(${invoice.currencyUomId})}"
										navigation-form-name="ListInvoiceApplications">
										<link target="editInvoiceApplications" text="${uiLabelMap.CommonUpdate}"
											style="buttontext">
											<parameter param-name="invoiceId" />
										</link>
										<include-form name="ListInvoiceApplications"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet> -->
								</container>
								 <container style="righthalf">
								 	<screenlet
										title="${uiLabelMap.AccountingAppliedPayments} ${appliedAmount?currency(${invoice.currencyUomId})} ${uiLabelMap.AccountingOpenPayments} ${notAppliedAmount?currency(${invoice.currencyUomId})}"
										navigation-form-name="ListInvoiceApplications">
										<link target="editInvoiceApplications" text="${uiLabelMap.CommonUpdate}"
											style="buttontext">
											<parameter param-name="invoiceId" />
										</link>
										<include-form name="ListInvoiceApplications"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<!-- <screenlet title="${uiLabelMap.AccountingInvoiceRoles}"
										navigation-form-name="invoiceRoles">
										<container>
											<link target="invoiceRoles" text="${uiLabelMap.CommonUpdate}"
												style="buttontext">
												<parameter param-name="invoiceId" />
											</link>
										</container>
										<include-form name="invoiceRoles"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<screenlet title="${uiLabelMap.PartyTerms}">
										<include-form name="ListInvoiceTerms"
											location="component://accounting/widget/InvoiceForms.xml" />
										<include-form name="ListInvoicePaymentInfo"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet> -->
								</container> 
								<container style="clear" />
								<screenlet title="${uiLabelMap.AccountingInvoiceItems}"
									navigation-form-name="invoiceItems">
									<link target="listInvoiceItems" text="${uiLabelMap.CommonUpdate}"
										style="buttontext">
										<parameter param-name="invoiceId" />
									</link>
									<include-form name="invoiceItems"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
								<section>
									<condition>
										<not>
											<if-empty field="timeEntries" />
										</not>
									</condition>
									<widgets>
										<screenlet title="${uiLabelMap.AccountingInvoiceTimeEntries}"
											navigation-form-name="ListTimeEntries">
											<link target="editInvoiceTimeEntries" text="${uiLabelMap.CommonUpdate}"
												style="buttontext">
												<parameter param-name="invoiceId" />
											</link>
											<include-form name="ListTimeEntries"
												location="component://accounting/widget/InvoiceForms.xml" />
										</screenlet>
									</widgets>
								</section>
								<screenlet title="${uiLabelMap.AccountingTransactions}"
									navigation-form-name="AcctgTransAndEntries">
									<include-form name="AcctgTransAndEntries"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
							</widgets>
							<fail-widgets>
								<screenlet title="${uiLabelMap.AccountingInvoiceHeader}">
									<include-form name="invoiceHeader"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
								<container style="lefthalf">
									<screenlet title="${uiLabelMap.CommonStatus}"
										navigation-form-name="ListInvoiceStatus">
										<include-form name="ListInvoiceStatus"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<screenlet
										title="${uiLabelMap.AccountingAppliedPayments} ${appliedAmount?currency(${invoice.currencyUomId})} ${uiLabelMap.AccountingOpenPayments} ${notAppliedAmount?currency(${invoice.currencyUomId})}"
										navigation-form-name="ListInvoiceApplications">
										<include-form name="ListInvoiceApplications"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
								</container>
								<container style="righthalf">
									<screenlet title="${uiLabelMap.AccountingInvoiceRoles}"
										navigation-form-name="invoiceRoles">
										<include-form name="invoiceRoles"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<screenlet title="${uiLabelMap.PartyTerms}">
										<include-form name="ListInvoiceTerms"
											location="component://accounting/widget/InvoiceForms.xml" />
										<include-form name="ListInvoicePaymentInfo"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
								</container>
								<container style="clear" />
								<screenlet title="${uiLabelMap.AccountingInvoiceItems}"
									navigation-form-name="invoiceItems">
									<include-form name="invoiceItems"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
								<section>
									<condition>
										<not>
											<if-empty field="timeEntries" />
										</not>
									</condition>
									<widgets>
										<screenlet title="${uiLabelMap.AccountingInvoiceTimeEntries}"
											navigation-form-name="ListTimeEntries">
											<include-form name="ListTimeEntries"
												location="component://accounting/widget/InvoiceForms.xml" />
										</screenlet>
									</widgets>
								</section>
								<screenlet title="${uiLabelMap.AccountingTransactions}"
									navigation-form-name="AcctgTransAndEntries">
									<include-form name="AcctgTransAndEntries"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
							</fail-widgets>
						</section>
						</fail-widgets>
						</section>
						
					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	
	 <!-- =================== AR INVOICES =================== -->
	 
	<screen name="FindArInvoices">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingFindArInvoices"/>
                <service service-name="performFind" result-map="result">
                    <field-map field-name="inputFields" from-field="parameters"/>
                    <field-map field-name="entityName" value="InvoiceAndType"/>
                    <field-map field-name="orderBy" value="invoiceDate DESC"/>
                </service>
                <set field="invoices" from-field="result.listIt"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="ARINVOICE_EDIT"/>
                </service>
                <set field="hasArInvoiceEditPermission" from-field="permResult.hasPermission"/>  
                 <set field="parentTypeId" from-field="parameters.parentTypeId" />      
                 <set field="tabButtonItem" value="accountReceivable"/>
                <set field="tabButtonItem5" value="${parameters.subTabButtonValue}"/>
                <set field="tabButtonItem2" value="${parameters.actionSubTabButtonValue}"/>
                <set field="invoiceTypeId"  value="${parameters.invoiceTypeId}"/>
                 <script location="component://accounting/webapp/ap/WEB-INF/actions/invoices/voucherPaymentMethod.groovy"/>            
            </actions>
            <widgets>
                 <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="ARInvoiceTypesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<include-menu name="ARInvoiceTabBar" location="component://accounting/widget/AccountingMenus.xml" />
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="menu-bar">
                                    	<section>
                    						<condition>
                    							<if-compare operator="equals" value="true" field="hasArInvoiceEditPermission"/>
                    						</condition>
                    						<widgets>
                                       			 <container style="button-bar">
                                            		<!--   <link target="newInvoice" text="${uiLabelMap.CommonCreateNew}" style="buttontext create"/> -->
                                            		<!-- <link target="newInvoice" text="New Cash Voucher" style="buttontext create" > <parameter param-name="prefPaymentMethodTypeId" value="CASH"></parameter></link>
                                            		<link target="newInvoice" text="New Bank Voucher" style="buttontext create"><parameter param-name="prefPaymentMethodTypeId" value="BANK"></parameter></link>  -->
                                            		
                                            		<link target="CreateARInvoice" text="Create Cash Voucher" style="buttontext create" > 
		                                            	<parameter param-name="prefPaymentMethodTypeId" value="CASH"></parameter>
		                                            	<parameter param-name="subTabButtonValue" value="${parameters.subTabButtonValue}"></parameter>
		                                            	<parameter param-name="invoiceTypeId" value="${parameters.invoiceTypeId}"></parameter>
		                                            	<parameter param-name="showCreateButton" value="Y"></parameter>
		                                            </link>
		                                        	<link target="CreateARInvoice" text="Create Bank Voucher" style="buttontext create" >
		                                        		<parameter param-name="prefPaymentMethodTypeId" value="BANK"></parameter>
		                                        		<parameter param-name="subTabButtonValue" value="${parameters.subTabButtonValue}"></parameter>
		                                        		<parameter param-name="invoiceTypeId" value="${parameters.invoiceTypeId}"></parameter>
		                                        		<parameter param-name="showCreateButton" value="Y"></parameter>
		                                        	</link>
		                                        	<link target="partyFinanHistory" text="Party Financial History" style="buttontext create"></link>
                                       			 </container>
                                       		</widgets>
                                       		</section>	 
                                    </decorator-section>
                                    <decorator-section name="search-options">
                                        <include-form name="FindArInvoices" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
            							<screenlet title="Invoices List"> 
            								<section>   
            									<condition>
            										<not><if-empty field="invoices" /></not>
            									</condition>
            									<widgets>              							                                   
		            								<link text="${uiLabelMap.AccountingExportAsCsv}" style="buttontext"
														target="InvoiceSearchResultsCsv.csv">
														<parameter param-name="parentTypeId" from-field="parameters.parentTypeId"/>
														<parameter param-name="invoiceId_op" from-field="parameters.invoiceId_op"/>
														<parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
														<parameter param-name="invoiceId_ic" from-field="parameters.invoiceId_ic"/>
														<parameter param-name="description_op" from-field="parameters.description_op"/>
														<parameter param-name="description" from-field="parameters.description"/>
														<parameter param-name="description_ic" from-field="parameters.description_ic"/>
														<parameter param-name="invoiceTypeId" from-field="parameters.invoiceTypeId"/>
														<parameter param-name="statusId" from-field="parameters.statusId"/>
														<parameter param-name="partyIdFrom" from-field="parameters.partyIdFrom"/>
														<parameter param-name="partyId" from-field="parameters.partyId"/>
														<parameter param-name="invoiceDate_fld0_value" from-field="parameters.invoiceDate_fld0_value"/>
														<parameter param-name="invoiceDate_fld0_op" from-field="parameters.invoiceDate_fld0_op"/>
														<parameter param-name="invoiceDate_fld1_value" from-field="parameters.invoiceDate_fld1_value"/>
														<parameter param-name="invoiceDate_fld1_op" from-field="parameters.invoiceDate_fld1_op"/>
														<parameter param-name="dueDate_fld0_value" from-field="parameters.dueDate_fld0_value"/>
														<parameter param-name="dueDate_fld0_op" from-field="parameters.dueDate_fld0_op"/>
														<parameter param-name="dueDate_fld1_value" from-field="parameters.dueDate_fld1_value"/>
														<parameter param-name="dueDate_fld1_op" from-field="parameters.dueDate_fld1_op"/>
													</link>	  
												</widgets>
											</section>               
                                        	<platform-specific>
                                            	<html><html-template location="component://accounting/webapp/accounting/invoice/ListSearchInvoicesARTreasurerPortal.ftl"/></html>
                                        	</platform-specific>
                                        </screenlet>
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen> 
	<screen name="CreateARInvoice">
        <section>
            <actions>
            	<set field="tabButtonItem" value="accountReceivable"/>
                <set field="tabButtonItem5" value="${parameters.subTabButtonValue}"/>
            	<set field="tabButtonItem2" value="${parameters.actionSubTabButtonValue}" default-value="createInvoice"/>
            	<set field="invoiceTypeId"  value="${parameters.invoiceTypeId}"/>
				<set field="layoutSettings.javaScripts[]" value="/accounting/images/commonInvoice.js" global="true"/>                                   
				<set field="layoutSettings.javaScripts[]" value="/accounting/images/receivableInvoice.js" global="true"/> 
				 <script location="component://accounting/webapp/ap/WEB-INF/actions/invoices/voucherPaymentMethod.groovy"/>
                <set field="titleProperty" value="${arScreenTitle}"/>
                <set field="prefPaymentMethodTypeId"  from-field="parameters.prefPaymentMethodTypeId"/>
                <service service-name="acctgInvoicePermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="ARINVOICE_EDIT"/>
                </service>
                <set field="hasArInvoiceEditPermission" from-field="permResult.hasPermission"/>
                <entity-one entity-name="Invoice" value-field="invoice" />
				<entity-one entity-name="InvoiceItem" value-field="invoiceItem" />
				<entity-and entity-name="InvoiceItem" list="invoiceItems">
					<field-map field-name="invoiceId" from-field="parameters.invoiceId" />
					<order-by field-name="invoiceItemSeqId" />
				</entity-and>
				<script	location="component://accounting/webapp/accounting/WEB-INF/actions/invoice/GetInvoiceItemTypes.groovy" />
				<entity-condition entity-name="InvoiceItemType"	list="PayrolGroup">
					<condition-expr field-name="parentTypeId" value="PAYROL" />
				</entity-condition>
				<entity-condition entity-name="InvoiceItemType"	list="PayrolList"></entity-condition>
				<service service-name="acctgInvoicePermissionCheck"	result-map="permResult">
					<field-map field-name="mainAction" value="ARINVOICE_EDIT" />
				</service>
				<set field="invoiceId" value="${invoice.invoiceId}" />
				<set field="showCreateButton" value="${parameters.showCreateButton}" />
				<set field="showUpdateButton" value="${parameters.showUpdateButton}" />
            </actions>
            <widgets>
            
                <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                    	<include-menu name="ARInvoiceTypesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<include-menu name="ARInvoiceTabBar"
									location="component://accounting/widget/AccountingMenus.xml" />
						<!-- <include-menu name="CreateArInvoiceSubTabBar"
									location="component://accounting/widget/AccountingMenus.xml" /> -->
                        <section>
                        	<condition>
                    			<if-compare operator="equals" value="true" field="hasArInvoiceEditPermission"/>
                    		</condition>
                            <widgets>
                                <screenlet title="${arScreenTitle}">
                                    <include-form name="CreateARInvoice" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                            	<label style="h3" text="${uiLabelMap.newInvoiceScreenError}"/>
                            </fail-widgets>
                        </section>
						<section>
							
							<condition>
								<and>
									<not><if-empty field="invoice" /></not>
									<if-compare field="invoice.statusId" operator="equals"	value="INVOICE_IN_PROCESS" />
									<if-compare field="invoice.invoiceTypeId" operator="not-equals"	value="PAYROL_INVOICE" />
									<or>
										<if-compare operator="equals" value="true" field="hasArInvoiceEditPermission" />
										<if-compare operator="equals" value="true" field="hasApInvoiceEditPermission" />
									</or>
								</and>
							</condition>
							<widgets>
								<platform-specific>
		                           	<html><html-template location="component://accounting/webapp/accounting/invoice/AddSalesInvoiceItems.ftl"/></html>
		                       	</platform-specific>
							</widgets>
						</section> 
						
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
	<screen name="ARInvoiceOverview">
		<section>
			<actions>
				<property-map resource="PartyUiLabels" map-name="uiLabelMap"
					global="true" />
				<set field="titleProperty" value="PageTitleInvoiceOverview" />
				<set field="tabButtonItem" value="accountReceivable"/>
                <set field="tabButtonItem5" value="${parameters.subTabButtonValue}"/>
            	<set field="tabButtonItem2" value="invoiceOverview"/>
            	<set field="invoiceTypeId"  value="${parameters.invoiceTypeId}"/>
				<set field="invoiceId" from-field="parameters.invoiceId" />
				<entity-one entity-name="Invoice" value-field="invoice" />
				<entity-and entity-name="InvoiceRole" list="invoiceRoles">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="partyId" />
				</entity-and>
				<entity-and entity-name="InvoiceStatus" list="invoiceStatus">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="statusDate" />
				</entity-and>
				<entity-and entity-name="InvoiceTerm" list="invoiceTerms">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="invoiceTermId" />
				</entity-and>
				<entity-and entity-name="TimeEntry" list="timeEntries">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="invoiceItemSeqId" />
				</entity-and>
				<!-- <entity-and entity-name="PaymentApplication" list="paymentApplications">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="paymentApplicationId" />
				</entity-and> -->
				<entity-and entity-name="PaymentAndApplication" list="payment">
					<field-map from-field="parameters.invoiceId" field-name="invoiceId" />
					<order-by field-name="paymentId" />
				</entity-and>
				<script
					location="component://accounting/webapp/accounting/WEB-INF/actions/invoice/CreateApplicationList.groovy" />
				<script
					location="component://accounting/webapp/accounting/WEB-INF/actions/invoice/OrderListInvoiceItem.groovy" />
				<set field="invoiceAmount"
					value="${bsh:org.ofbiz.accounting.invoice.InvoiceWorker.getInvoiceTotal(invoice)}"
					type="BigDecimal" />
				<set field="notAppliedAmount"
					value="${bsh:org.ofbiz.accounting.invoice.InvoiceWorker.getInvoiceNotApplied(invoice)}"
					type="BigDecimal" />
				<set field="appliedAmount"
					value="${bsh:org.ofbiz.accounting.invoice.InvoiceWorker.getInvoiceApplied(invoice)}"
					type="BigDecimal" />
				<entity-condition entity-name="AcctgTransAndEntries"
					list="AcctgTransAndEntries">
					<condition-expr field-name="invoiceId" operator="equals"
						from-field="invoiceId" />
					<order-by field-name="acctgTransId" />
				</entity-condition>
				<service service-name="acctgInvoicePermissionCheck"
					result-map="permResult">
					<field-map field-name="mainAction" value="ARINVOICE_EDIT" />
				</service>
				<set field="hasArInvoiceEditPermission" from-field="permResult.hasPermission" />
				<service service-name="acctgInvoicePermissionCheck"
					result-map="permResult">
					<field-map field-name="mainAction" value="INVOICE_APPROVE" />
				</service>
				<set field="hasApproveInvoiceEditPermission" from-field="permResult.hasPermission" />
				<service service-name="acctgInvoicePermissionCheck"
					result-map="permResult">
					<field-map field-name="mainAction" value="APINVOICE_EDIT" />
				</service>
				<set field="hasApInvoiceEditPermission" from-field="permResult.hasPermission" />
				<set field="localDispatcherName" value="${parameters.localDispatcherName}" />
				<set field="requestUri" value="${parameters.targetRequestUri}"/>
			</actions>
			<widgets>
				<decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
					<decorator-section name="body">
						<include-menu name="ARInvoiceTypesTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                    	<include-menu name="ARInvoiceTabBar"
									location="component://accounting/widget/AccountingMenus.xml" />
						<include-menu name="CreateArInvoiceSubTabBar"
									location="component://accounting/widget/AccountingMenus.xml" />
									<container style="h1"><label>For: ${invoice.description} [${invoice.invoiceId}]</label></container>
						<section>
							<condition>
								<and>
									<if-compare field="invoice.statusId" operator="equals" value="INVOICE_IN_PROCESS" />
									<if-compare field="invoice.invoiceTypeId" operator="equals" value="PETTYCASH_INVOICE" />
									<if-compare field="requestUri" operator="equals" value="/createInvoice" />
								</and>
							</condition>
							<actions>
								<script
									location="component://accounting/webapp/accounting/WEB-INF/actions/invoice/GetInvoiceItemTypes.groovy" />
							</actions>
							<widgets>
							<screenlet title="${uiLabelMap.AccountingInvoiceItems}">
							<include-form name="EditInvoiceItems"
								location="component://accounting/widget/InvoiceForms.xml" />
						</screenlet>
						<section>
							<condition>
								<and>
									<if-compare field="invoice.invoiceTypeId" operator="not-equals"
										value="PAYROL_INVOICE" />
									<or>
										<if-compare operator="equals" value="true"
											field="hasArInvoiceEditPermission" />
										<if-compare operator="equals" value="true"
											field="hasApInvoiceEditPermission" />
									</or>
								</and>
							</condition>
							<widgets>
								<screenlet title="${uiLabelMap.AccountingInvoiceItemAdd}">
									<section>
										<widgets>
											<include-form name="EditInvoiceItem"
												location="component://accounting/widget/InvoiceForms.xml" />
										</widgets>
									</section>
								</screenlet>
							</widgets>
						</section>
							</widgets>
						<fail-widgets>
						<section>
							<condition>
								<and>
									<if-compare field="invoice.statusId" operator="equals"
										value="INVOICE_IN_PROCESS" />
									<or>
										<if-compare operator="equals" value="true"
											field="hasArInvoiceEditPermission" />
										<if-compare operator="equals" value="true"
											field="hasApInvoiceEditPermission" />
									</or>
								</and>
							</condition>
							<widgets>
								<screenlet title="${uiLabelMap.AccountingInvoiceHeader}">
									<link target="editInvoice" text="${uiLabelMap.CommonUpdate}"
										style="buttontext">
										<parameter param-name="invoiceId" />
									</link>
									<include-form name="invoiceHeader"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
								<container style="lefthalf">
									<screenlet title="${uiLabelMap.CommonStatus}"
										navigation-form-name="ListInvoiceStatus">
										<include-form name="ListInvoiceStatus"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<!-- <screenlet
										title="${uiLabelMap.AccountingAppliedPayments} ${appliedAmount?currency(${invoice.currencyUomId})} ${uiLabelMap.AccountingOpenPayments} ${notAppliedAmount?currency(${invoice.currencyUomId})}"
										navigation-form-name="ListInvoiceApplications">
										<link target="editInvoiceApplications" text="${uiLabelMap.CommonUpdate}"
											style="buttontext">
											<parameter param-name="invoiceId" />
										</link>
										<include-form name="ListInvoiceApplications"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet> -->
								</container>
								 <container style="righthalf">
								 	<screenlet
										title="${uiLabelMap.AccountingAppliedPayments} ${appliedAmount?currency(${invoice.currencyUomId})} ${uiLabelMap.AccountingOpenPayments} ${notAppliedAmount?currency(${invoice.currencyUomId})}"
										navigation-form-name="ListInvoiceApplications">
										<link target="editInvoiceApplications" text="${uiLabelMap.CommonUpdate}"
											style="buttontext">
											<parameter param-name="invoiceId" />
										</link>
										<include-form name="ListInvoiceApplications"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<!-- <screenlet title="${uiLabelMap.AccountingInvoiceRoles}"
										navigation-form-name="invoiceRoles">
										<container>
											<link target="invoiceRoles" text="${uiLabelMap.CommonUpdate}"
												style="buttontext">
												<parameter param-name="invoiceId" />
											</link>
										</container>
										<include-form name="invoiceRoles"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<screenlet title="${uiLabelMap.PartyTerms}">
										<include-form name="ListInvoiceTerms"
											location="component://accounting/widget/InvoiceForms.xml" />
										<include-form name="ListInvoicePaymentInfo"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet> -->
								</container> 
								<container style="clear" />
								<screenlet title="${uiLabelMap.AccountingInvoiceItems}"
									navigation-form-name="invoiceItems">
									<link target="listInvoiceItems" text="${uiLabelMap.CommonUpdate}"
										style="buttontext">
										<parameter param-name="invoiceId" />
									</link>
									<include-form name="invoiceItems"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
								<section>
									<condition>
										<not>
											<if-empty field="timeEntries" />
										</not>
									</condition>
									<widgets>
										<screenlet title="${uiLabelMap.AccountingInvoiceTimeEntries}"
											navigation-form-name="ListTimeEntries">
											<link target="editInvoiceTimeEntries" text="${uiLabelMap.CommonUpdate}"
												style="buttontext">
												<parameter param-name="invoiceId" />
											</link>
											<include-form name="ListTimeEntries"
												location="component://accounting/widget/InvoiceForms.xml" />
										</screenlet>
									</widgets>
								</section>
								<screenlet title="${uiLabelMap.AccountingTransactions}"
									navigation-form-name="AcctgTransAndEntries">
									<include-form name="AcctgTransAndEntries"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
							</widgets>
							<fail-widgets>
								<screenlet title="${uiLabelMap.AccountingInvoiceHeader}">
									<include-form name="invoiceHeader"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
								<container style="lefthalf">
									<screenlet title="${uiLabelMap.CommonStatus}"
										navigation-form-name="ListInvoiceStatus">
										<include-form name="ListInvoiceStatus"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<screenlet
										title="${uiLabelMap.AccountingAppliedPayments} ${appliedAmount?currency(${invoice.currencyUomId})} ${uiLabelMap.AccountingOpenPayments} ${notAppliedAmount?currency(${invoice.currencyUomId})}"
										navigation-form-name="ListInvoiceApplications">
										<include-form name="ListInvoiceApplications"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
								</container>
								<container style="righthalf">
									<screenlet title="${uiLabelMap.AccountingInvoiceRoles}"
										navigation-form-name="invoiceRoles">
										<include-form name="invoiceRoles"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
									<screenlet title="${uiLabelMap.PartyTerms}">
										<include-form name="ListInvoiceTerms"
											location="component://accounting/widget/InvoiceForms.xml" />
										<include-form name="ListInvoicePaymentInfo"
											location="component://accounting/widget/InvoiceForms.xml" />
									</screenlet>
								</container>
								<container style="clear" />
								<screenlet title="${uiLabelMap.AccountingInvoiceItems}"
									navigation-form-name="invoiceItems">
									<include-form name="invoiceItems"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
								<section>
									<condition>
										<not>
											<if-empty field="timeEntries" />
										</not>
									</condition>
									<widgets>
										<screenlet title="${uiLabelMap.AccountingInvoiceTimeEntries}"
											navigation-form-name="ListTimeEntries">
											<include-form name="ListTimeEntries"
												location="component://accounting/widget/InvoiceForms.xml" />
										</screenlet>
									</widgets>
								</section>
								<screenlet title="${uiLabelMap.AccountingTransactions}"
									navigation-form-name="AcctgTransAndEntries">
									<include-form name="AcctgTransAndEntries"
										location="component://accounting/widget/InvoiceForms.xml" />
								</screenlet>
							</fail-widgets>
						</section>
						</fail-widgets>
						</section>
						
					</decorator-section>
				</decorator-screen>
			</widgets>
		</section>
	</screen>
	<screen name="FindTreasurerPayments">
        <section>
            <actions>
            	<set field="titleProperty" value="Treasurer Payments" />
                <set field="tabButtonItem" value="treasurerPayments"/>
                <set field="tabButtonItem4" value="FindTreasurerPayments"/>
                <!--
                 <set field="parameters.findPaymentMethodType" value="bankOrNonBankMethodType"/>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/findPaymentMethodType.groovy"/> -->
            </actions>
            <widgets>
                 <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                        <section>
                            <widgets>
                                <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                                    <decorator-section name="search-options">
                                        <include-form name="FindTreasurerPayments" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                    <decorator-section name="search-results">
                                        <include-form name="ListTreasurerPayments"  location="component://accounting/widget/TreasurerPortalForms.xml"/>
                                    </decorator-section>
                                </decorator-screen>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="ViewDepositTransactions">
       <section>
            <actions>
            	<set field="titleProperty" value="View Deposit Transactions"/>
                  <set field="tabButtonItem" value="FindDepositAccount"/>
                 <set field="tabButtonItem2" value="FindDepositAccount"/>
            </actions>
            <widgets>
                 <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
                    <decorator-section name="body">
                        <section>
                            <widgets>
								<screenlet title="List Deposit Transactions">
									<section>
										<widgets>
											<include-form name="ListDepositTransactions"  location="component://accounting/widget/TreasurerPortalForms.xml"/>
										</widgets>
									</section>
								</screenlet>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="FinAccountTransForReconsileNEWWORK">
        <section>
            <actions>
                <set field="titleProperty" value="CreateBankAccountReconciliationsTitle"/>
                <!--   <set field="tabButtonItem" value="FindFinAccountAlt"/> -->
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/>
                  	<set field="tabButtonItem"  value="${parameters.tabButtonItem}" default-value="${context.tabButtonItem}"/>
               <!--  <set field="tabButtonItem2" value="${parameters.subTabItem}"/> -->
                <set field="tabButtonItem2" value="FinAccountTransForReconsile"/>
                <set field="parameters.glReconciliationId" value="${glReconciliationId}"/><!-- instead of Form we are setting in Screen  -->
                <set field="parameters.finAccountId" value="${finAccountId}"/>
                 <set field="parameters.statusId" value="FINACT_TRNS_CREATED"/>
                 <set field="glReconciliationId" value="${glReconciliationId}"/>
                   <set field="glReconciliationId" value="${glReconciliationId}"/>
                   <!-- <set field="parameters.fromTrnsactionDate" from-field="parameters.fromTransactionDate" />
                  <set field="parameters.thruTransactionDate" from-field="parameters.thruTransactionDate" /> -->
               <!--   <set field="parameters.noConditionFind" value="Y"/> -->
                 
                <service service-name="getFinAccountTransListAndTotals" result-map="finAccountTransListAndTotals" auto-field-map="true"/>
                <set field="finAccountTransList" type="List" from-field="finAccountTransListAndTotals.finAccountTransList"/>
                <set field="searchedNumberOfRecords" type="Integer" from-field="finAccountTransListAndTotals.searchedNumberOfRecords"/>
                <set field="grandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.grandTotal"/>
                <set field="createdGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdGrandTotal"/>
                <set field="totalCreatedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedTransactions"/>
                <set field="approvedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.approvedGrandTotal"/>
                <set field="totalApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalApprovedTransactions"/>
                <set field="createdApprovedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdApprovedGrandTotal"/>
                <set field="totalCreatedApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedApprovedTransactions"/>
                 <set field="finAccountId" from-field="parameters.finAccountId"/> 
                <entity-one entity-name="FinAccount"  value-field="finAccount"/>
                <set field="glReconciliationId" from-field="parameters.glReconciliationId"/> 
                <set field="finAccountTransId" from-field="parameters.finAccountTransId"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNTTX_EDIT"/>
                </service>
                <set field="hasFinTxEditPermission" from-field="permResult.hasPermission"/> 
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/finaccounttrans/FindFinAccountTrans.groovy"/>	
            </actions>
            <widgets>
               <!--   <decorator-screen name="CashierCommonDecorator" location="component://accounting/widget/CommonScreens.xml"> -->
                    <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml">
             <!--    <decorator-screen name="CommonFinAccountDecorator" location="${parameters.finAccountDecoratorLocation}"> -->
                    <decorator-section name="body">
                        <include-menu name="CompanyFinAccountTabBar" location="component://accounting/widget/AccountingMenus.xml"/>
                        <section>
                            <condition>
                            	<if-service-permission service-name="acctgFinAcctPermissionCheck"  main-action="FINACCOUNTREC_EDIT"> </if-service-permission>
                                <if-compare field="finAccount.finAccountTypeId" operator="equals" value="BANK_ACCOUNT" type="String"></if-compare>
                            </condition>
                            <widgets>
                              <!--   <link target="FinancialAccountReconciliation" text="${uiLabelMap.FinAccountReconciliation}" style="buttontext">
                                    <parameter param-name="finAccountId" from-field="finAccountId"/>
                                    <parameter param-name="statusId" value="FINACT_TRNS_CREATED"/>
                                </link> -->
                            </widgets>
                        </section>
                        <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                             <decorator-section name="search-options" >
                                 <include-form name="FinAccountTransForReconsile"  share-scope="false" location="component://accounting/widget/TreasurerPortalForms.xml"/> 
                            </decorator-section>  
                            <decorator-section name="search-results">
                             <include-form name="ReconcilationFormList" location="component://accounting/widget/TreasurerPortalForms.xml"/>
                            </decorator-section>
                        </decorator-screen>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="FinAccountTransForReconsileCSV">
		<section>
			<actions>
			
				<set field="viewSize" value="99999" />
				 <script location="component://accounting/webapp/accounting/WEB-INF/actions/EditFinaccount.groovy"/> 
                <set field="parameters.glReconciliationId" value="${glReconciliationId}"/><!-- instead of Form we are setting in Screen  -->
                <set field="parameters.finAccountId" value="${finAccountId}"/>
                 <set field="parameters.statusId" value="FINACT_TRNS_CREATED"/>
                 <set field="fromTransactionDate" value="${parameters.fromDateReport}"/>
                  <set field="thruTransactionDate" value="${parameters.thruDateReport}"/>                 
                 <set field="glReconciliationId" value="${glReconciliationId}"/>
                 <set field="finAccountTransTypeId" from-field="parameters.finAccountTransType" />
				 <service service-name="getFinAccountTransListAndTotals" result-map="finAccountTransListAndTotals" auto-field-map="true"/>
                <set field="finAccountTransList" type="List" from-field="finAccountTransListAndTotals.finAccountTransList"/>
                <set field="searchedNumberOfRecords" type="Integer" from-field="finAccountTransListAndTotals.searchedNumberOfRecords"/>
                <set field="grandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.grandTotal"/>
                <set field="createdGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdGrandTotal"/>
                <set field="totalCreatedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedTransactions"/>
                <set field="approvedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.approvedGrandTotal"/>
                <set field="totalApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalApprovedTransactions"/>
                <set field="createdApprovedGrandTotal" type="BigDecimal" from-field="finAccountTransListAndTotals.createdApprovedGrandTotal"/>
                <set field="totalCreatedApprovedTransactions" type="Long" from-field="finAccountTransListAndTotals.totalCreatedApprovedTransactions"/>
                 <set field="finAccountId" from-field="parameters.finAccountId"/> 
                <entity-one entity-name="FinAccount"  value-field="finAccount"/>
                <set field="glReconciliationId" from-field="parameters.glReconciliationId"/> 
                <set field="finAccountTransId" from-field="parameters.finAccountTransId"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNTTX_EDIT"/>
                </service>
                <set field="hasFinTxEditPermission" from-field="permResult.hasPermission"/> 
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/finaccounttrans/FindFinAccountTrans.groovy"/>
			</actions>
			<widgets>
				<section>
					<widgets>
					  <include-form name="ReconcilationFormListCSV" location="component://accounting/widget/TreasurerPortalForms.xml"/>
					</widgets>
				</section>
			</widgets>
		</section>
	</screen>
<screen name="FinAccountTransForReconciledCSV">
		<section>
			<actions>
			 <set field="tabButtonItem" value="FindFinAccountReconciliations"/>
                <set field="titleProperty" value="AccountingEditFinAccountReconciliations"/>
                <set field="finAccountId" from-field="parameters.finAccountId"/>
                <set field="glReconciliationId" from-field="parameters.glReconciliationId"/>
                <service service-name="acctgFinAcctPermissionCheck" result-map="permResult">
                    <field-map field-name="mainAction" value="FINACCOUNTREC_EDIT"/>
                </service>
                <set field="hasFinRecEditPermission" from-field="permResult.hasPermission"/> 
                <entity-one entity-name="FinAccount" value-field="finAccount"/>
                <entity-one entity-name="GlReconciliation" value-field="currentGlReconciliation"/>
                <entity-condition entity-name="GlReconciliation" list="glReconciliationList">
                    <condition-list combine="and">
                        <condition-expr field-name="reconciledDate" operator="less" from-field="currentGlReconciliation.reconciledDate" ignore-if-empty="true"/>
                        <condition-expr field-name="glAccountId" operator="equals" from-field="finAccount.postToGlAccountId"/>
                    </condition-list>
                    <order-by field-name="reconciledDate DESC"/>
                </entity-condition>
                <set field="previousGlReconciliation" from-field="glReconciliationList[0]"/>
                <service service-name="getFinAccountTransListAndTotals" result-map="transactionTotalAmount"/>
                <set field="finAccountTransList" from-field="transactionTotalAmount.finAccountTransList" type="List"/>
                <set field="finAccountTransIds" value="${groovy:org.ofbiz.entity.util.EntityUtil.getFieldListFromEntityList(finAccountTransList, 'finAccountTransId', true);}" type="List"/>
                <entity-condition entity-name="FinAccountTrans" list="finAccountTransactions">
                    <condition-list>
                        <condition-expr field-name="finAccountTransId" operator="in" from-field="finAccountTransIds"/>
                        <condition-expr field-name="statusId" value="FINACT_TRNS_CREATED"/>
                    </condition-list>
                </entity-condition>
                <service service-name="isGlReconciliationReconciled" result-map="reconciledMap"/>
                <set field="isReconciled" from-field="reconciledMap.isReconciled"/>
                <service service-name="getReconciliationClosingBalance" result-map="currentRecnciliationClosingBalance"/>
                <set field="currentClosingBalance" from-field="currentRecnciliationClosingBalance.closingBalance"/>
                <set field="previousGlReconciliationId" from-field="previousGlReconciliation.glReconciliationId" default-value="${glReconciliationId}"/>
                <service service-name="getReconciliationClosingBalance" result-map="previousReconciliationClosingBalance">
                    <field-map field-name="glReconciliationId" from-field="previousGlReconciliationId"/>
                </service>
                <set field="previousClosingBalance" from-field="previousReconciliationClosingBalance.closingBalance"/>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/finaccounttrans/FindFinAccountTrans.groovy"/> 
			</actions>
			<widgets>		
				<section>
					<widgets>		
					  <include-form name="ReconcilationFormListCSV" location="component://accounting/widget/TreasurerPortalForms.xml"/>
					</widgets>
				</section>	
			</widgets>
		</section>
	</screen>
	<screen name="AccountReports">
        <section>
            <actions>
                <set field="titleProperty" value="Accounting Reports"/>
                  <set field="tabButtonItem" value="Reports"/>
                 <set field="tabButtonItem2" value="Reports"/>
                <set field="viewIndex" from-field="parameters.VIEW_INDEX" type="Integer" default-value="0"/>
                <set field="viewSize" from-field="parameters.VIEW_SIZE" type="Integer" default-value="20"/>
               <!--  <set field="displayAdvancedSearch" from-field="parameters.displayAdvancedSearch"/> -->
                <set field="parameters.ownerPartyId" value="Company"/>
                <set field="parameters.finAccountTypeId" value="BANK_ACCOUNT"/>
                <set field="noConditionFind" value="Y"/>
                <!-- <field name="noConditionFind"><hidden value="Y"/> -->
                <set field="screenFlag" value="REPORTS" /> 
		        <entity-condition entity-name="FinAccount" list="finAccounts">
		           <condition-list> 
		           <condition-expr field-name="finAccountTypeId" operator="equals" from-field="parameters.finAccountTypeId"/>
				   <condition-expr field-name="ownerPartyId" operator="equals" from-field="parameters.ownerPartyId" />
				   </condition-list> 
				</entity-condition>  
				<entity-condition entity-name="PaymentType" list="paymentTypes">
	                <condition-list combine="or">
	                    <condition-expr field-name="parentTypeId" operator="equals" value="ADVANCES_PAYOUT"/>
	                </condition-list>
	                <order-by field-name="description"/>
	            </entity-condition>
                <set field="hasFinEditPermission" from-field="permResult.hasPermission"/>
                <set field="organizationPartyId" value="Company"></set>
                <entity-condition list="customtimeperiodlist" entity-name="CustomTimePeriod"  filter-by-date="false">
                <condition-list>
                <condition-expr field-name="periodTypeId" operator="like" value="FISCAL_%"/>
                  <condition-expr field-name="organizationPartyId" operator="equals" value="Company"/>
                    </condition-list>
                    <order-by field-name="-thruDate"/>
                     <order-by field-name="periodNum"/>
               </entity-condition>
              </actions>
            <widgets>
                 <decorator-screen name="CommonTreasurerPortalDecorator" location="component://accounting/widget/CommonScreens.xml"> 
                    <decorator-section name="body">
								<platform-specific>
		                           	<html><html-template location="component://accounting/webapp/accounting/reports/AccountingReports.ftl"/></html>
		                       	</platform-specific>						
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="AdvancesReport">
		<section>
			<actions>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/reports/AdvancesReport.groovy"/>
            </actions>
			<widgets>
				<platform-specific> 
					<xsl-fo><html-template location="component://accounting/webapp/accounting/reports/AdvancesReport.fo.ftl"/></xsl-fo> 
                </platform-specific>
			</widgets>
		</section>
	</screen>
	<screen name="SubLedgerReport">
		<section>
			<actions>
                 <script location="component://accounting/webapp/accounting/WEB-INF/actions/reports/AdvancesReport.groovy"/>
            </actions>
			<widgets>
				<platform-specific> 
					<xsl-fo><html-template location="component://accounting/webapp/accounting/reports/AdvSubledgerReport.fo.ftl"/></xsl-fo> 
                </platform-specific>
			</widgets>
		</section>
	</screen>
</screens>