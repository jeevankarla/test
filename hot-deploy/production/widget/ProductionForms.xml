<?xml version="1.0" encoding="UTF-8"?>
<forms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-form.xsd">


   <!-- Production Lookup Facility -->
     <form name="productionLookupFacility" target="ProductionLookupFacility" title="" type="single"
        header-row-style="header-row" default-table-style="basic-table">
        <!--<auto-fields-entity entity-name="Facility" default-field-type="hidden"/> -->
        <field name="facilityId"><text-find/></field>
        <field name="facilityName"><text-find/></field>
        <field name="facilityTypeId_0" title="FacilityTypeId">
            <drop-down allow-empty="true" >
                <option key="SILO" description="SILO"/>
                <option key="PLANT" description="Plant"/>
                <option key="FLOOR" description="Floor"/>
                <option key="STORAGE" description="STORAGE"/>
            </drop-down>
        </field>
        <field name="ownerPartyId" title="${uiLabelMap.ProductFacilityOwner}"><lookup target-form-name="LookupPartyName"/></field>
        <field name="noConditionFind"><hidden value="Y"/><!-- if this isn't there then with all fields empty no query will be done --></field>
        <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit"><submit button-type="button"/></field>
 	</form>
    <form name="listProductionLookupFacility" list-name="listIt" title="" type="list"
        odd-row-style="alternate-row" default-table-style="basic-table hover-bar" paginate-target="ProductionLookupFacility">
        <actions>
            <service service-name="performFind" result-map="result" result-map-list="listIt">
                <field-map field-name="inputFields" from-field="parameters"/>
                <field-map field-name="entityName" value="Facility"/>
                <field-map field-name="viewIndex" from-field="viewIndex"/>
                <field-map field-name="viewSize" from-field="viewSize"/>
            </service>
        </actions>
        <field name="facilityId" title="${uiLabelMap.CommonEmptyHeader}" widget-style="buttontext">
            <hyperlink also-hidden="false" target-type="plain" description="${facilityId}" target="javascript:set_values('${facilityId}', '${facilityName}')"/>
        </field>
        <field name="facilityName" ><display/></field>
        <field name="facilityTypeId"><display/></field>
 	</form>

	<!-- PowderPlant forms -->
	<form name="PowderShiftStartDetails" type="single">
		<field name="shift" title="Shift" position="1"><display/></field>
		<field name="todayDate" title="Date" position="1"><display/></field>
		<field name="currentTime" title="Time" position="1"><display/></field>
		<field name="instructions" title="Instructions" position="1"><textarea read-only="true"/></field>
		
	</form>
	<form name="PowderShiftStart" type="list" list-name="shiftSiloDetailsList" paginate="false" odd-row-style="alternate-row" header-row-style="header-row-2" default-table-style="basic-table hover-bar">
		<row-actions>
		
			<entity-one value-field="Product" entity-name="Product">
				<field-map field-name="productId" from-field="productId"/>
			</entity-one>
			<set field="productCode" value="${Product.brandName}" />
			<set field="productName" value="${Product.productName}" />
		
		</row-actions>
	
		<field name="siloId" title="SILO"><display-entity entity-name="Facility" description="${description}" size="25" key-field-name="facilityId"/></field>
		<field name="productCode" title="Product Code"><display size="10"/></field>
		<field name="productName" title="Product Name"><display size="15"/></field>
		
		<field name="quantityKgs" title="OB"><display size="15" default-value="0"/></field>
		<field name="moisture" title="Moisture"><display size="15"/></field>
		<field name="fat"><display size="15"/></field>
		<field name="snf"><display size="15"/></field>
		<field name="acidity" title="Acidity"><display size="15"/></field>
		<field name="temparature" title="Temparature" > <display size="15"/></field>
		<field name="BD" title="BD" > <display  size="15"/></field>
		
     </form>
     
     <form name="FindFacilityProducts" odd-row-style="alternate-row" header-row-style="header-row" type="single"
    	default-table-style="basic-table hover-bar" separate-columns="true">    	   	
    	<field name="hideSearch"><hidden value="N"/></field>
        <field name="facilityId" title="Plant/Silo"><lookup target-form-name="ProductionLookupFacility"></lookup></field>
        <field name="productId" title="Product"><lookup target-form-name="LookupProduct"></lookup></field>
       	<field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit"><submit/></field>       
    </form>
    <form name="ListFacilityProducts" odd-row-style="alternate-row" header-row-style="header-row" type="list" list-name="storeProductInventory"
    	default-table-style="basic-table hover-bar" separate-columns="true" paginate-target="productionStockXfers">   
        <field name="facilityId" title="Store"><display-entity entity-name="Facility" key-field-name="facilityId" description="${facilityName} [${facilityId}]"/></field>
        <field name="productId" title="Product"><display-entity entity-name="Product" key-field-name="productId" description="${productName} [${internalName}]"/></field>
        <field name="qoh" title="Qty on Hand"><display/></field>
        <field name="atp" title="Avl. to Promise"><display/></field>
        <field name="viewButton" title=" " widget-style="buttontext"><hyperlink  target-type="plain" description="Stock Xfer"  target="javascript: showXferForm('${facilityId}', '${productId}');" ></hyperlink></field>
        <!-- <field name="Override" widget-style="buttontext"> 
        </field>-->
    </form>
    
    <form name="FindFacilityInventory" odd-row-style="alternate-row" header-row-style="header-row" type="single"
    	default-table-style="basic-table hover-bar" separate-columns="true">    	   	
    	<field name="hideSearch"><hidden value="Y"/></field>
        <field name="facilityId" title="Plant/Silo" required-field="true"><lookup target-form-name="LookupFacility"></lookup></field>
        <field name="productId" title="Product"><lookup target-form-name="LookupProduct"></lookup></field>
        <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit"><submit/></field>       
    </form>
    <form name="FindInventoryTransfers" odd-row-style="alternate-row" header-row-style="header-row" type="single"
    	default-table-style="basic-table hover-bar" separate-columns="true">    	   	
    	<field name="hideSearch"><hidden value="N"/></field>
        <field name="fromFacilityId" title="From Plant/Silo"><lookup target-form-name="ProductionLookupFacility"></lookup></field>
        <field name="productId" title="Product"><lookup target-form-name="LookupProduct"></lookup></field>
        <field name="toFacilityId" title="To Plant/Silo"><lookup target-form-name="ProductionLookupFacility"></lookup></field>
        <field name="statusId" title="To Plant/Silo"><hidden value="IXF_COMPLETE" /></field>
       	<field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit"><submit/></field>       
    </form>
    
     <form name="ListInventoryTransfers" type="list"  target="findStockXfer" title="" list-name="listIt"
        odd-row-style="alternate-row" default-table-style="basic-table hover-bar" paginate-target="findStockXfer">
        <actions>
            <service service-name="performFind"  result-map="result" result-map-list="listIt">
                <field-map field-name="inputFields" from-field="requestParameters"/>
                <field-map field-name="entityName" value="InventoryTransferGroupAndMemberSum"/>
                <field-map field-name="orderBy" value="transferGroupId DESC"/>
                <field-map field-name="viewIndex" from-field="viewIndex"/>
                <field-map field-name="viewSize" from-field="viewSize"/>
            </service>
        </actions>
        <field name="transferGroupId" title="Transfer Id">
        	<display />
        </field>
        <field name="fromFacilityId" title="From Plant/Silo">
        	<display-entity entity-name="Facility" key-field-name="facilityId" description="${facilityName} [${facilityId}]"></display-entity>
        </field>
        <field name="toFacilityId" title="To Plant/Silo">
        	<display-entity entity-name="Facility" key-field-name="facilityId" description="${facilityName} [${facilityId}]"></display-entity>
        </field>
        <field name="statusId" title="Status">
        	<display-entity entity-name="StatusItem" key-field-name="statusId" description="${description}"></display-entity>
        </field>
        <field name="productId" title="Product">
        	<display-entity entity-name="Product" key-field-name="productId" description="${productName} [${productId}]"></display-entity>
        </field>
        <field name="xferQtySum" title="Xfer Qty">
        	<display />
        </field>
    </form>
    
    <form name="FindProductVariance" target="findProductVariance" title="" type="single" default-map-name="parameters"
        header-row-style="header-row" default-table-style="basic-table">
        <actions>
        	<entity-condition entity-name="VarianceReason" list="varianceReason"></entity-condition>
        </actions>
        <field name="facilityId" title="Plant/Silo"><text-find/></field>
        <field name="productId" title="Product"><text-find/></field>
 		<field name="varianceReasonId" title="Reason">
			<drop-down allow-empty="true" >
				<list-options key-name="varianceReasonId" list-entry-name="reason" list-name="varianceReason" description="${reason.description}"/>
			</drop-down>
		</field>
		<field name="physicalInventoryDate" title="Entry Date"><date-find/></field>   
        <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit">
            <submit button-type="button"/>
        </field>
        <field name="noConditionFind"><hidden value="Y"/><!-- if this isn't there then with all fields empty no query will be done --></field>
    </form>
    
    <form name="ListProductVariance" type="list" use-row-submit="true" list-name="listIt" title="List of customer requests"
        odd-row-style="alternate-row" header-row-style="header-row-2" default-table-style="basic-table hover-bar">
       	<actions>
       		<service service-name="performFind" result-map="result" result-map-list="listIt">
            <field-map field-name="inputFields" from-field="parameters"/>
            <field-map field-name="entityName" value="PhysicalInventoryItemAndVariance"/>
            <field-map field-name="orderBy" value="-physicalInventoryDate"/>
            <field-map field-name="viewIndex" from-field="viewIndex"/>
            <field-map field-name="viewSize" from-field="viewSize"/>
          </service>
       	</actions>
        <field name="physicalInventoryId"  title="Variance Id" widget-style="buttontext"><display/></field>
        <field name="physicalInventoryDate"  title="Entry Date"><display description="${groovy:org.ofbiz.base.util.UtilDateTime.toDateString(physicalInventoryDate,&quot;dd-MM-yyyy&quot;)}"/></field>
        <field name="partyId"  title="Entry By">
            <display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName} [${partyId}]">
            </display-entity>
        </field>
        <field name="facilityId" title="Plant/Silo"><display/></field>
        <field name="productId"  title="Product">
            <display-entity key-field-name="productId" entity-name="Product" description="${productName} [${internalName}]"/>
        </field>
        <field name="varianceReasonId" title="Reason"><display-entity description="${description}" entity-name="VarianceReason" key-field-name="varianceReasonId"/></field>
        <field name="quantityOnHandVar" title="Variance"><display/></field>
        <field name="comments" title="Comments"><display/></field>
    </form>
    <form name="FindProductionRequest" target="FindProductionRequest" title="" type="single" default-map-name="parameters"
        header-row-style="header-row" default-table-style="basic-table">
        <actions>
          <set field="fromPartyId" from-field="partyId"/>
        </actions>
        <field name="custRequestId" title="${uiLabelMap.MaterialMangement_CustRequestId}"><text-find/></field>
        <field name="custRequestTypeId"><hidden value="parameters.custRequestTypeId"/></field>
        <field name="statusId" title="Status">
            <drop-down allow-empty="true">
                <entity-options entity-name="StatusItem" description="${description}">
                    <entity-constraint name="statusTypeId" operator="equals" value="CUSTREQ_STTS"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="custRequestName" title="${uiLabelMap.MaterialMangement_CustRequestName}"><text-find/></field>
        <!-- <field name="fromPartyId" title="${uiLabelMap.MaterialMangement_CustRequestFromPartyId}"><lookup target-form-name="LookupPartyName"/></field> -->
 		<field name="fromPartyId" title="${uiLabelMap.MaterialMangement_CustRequestFromPartyId}">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="finalDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
		<field name="partyIdFrom" title="${uiLabelMap.MaterialMangement_CustRequestToPartyId}">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="toDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
 		<field name="custRequestDate" title="${uiLabelMap.MaterialMangement_CustRequestDate}"><date-find/></field>   
        <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit">
            <submit button-type="button"/>
        </field>
        <field name="noConditionFind"><hidden value="Y"/><!-- if this isn't there then with all fields empty no query will be done --></field>
    </form>  
    <form name="ListProductionRequests" type="list" extends="ListProductionRequestList" list-name="listIt">
        <actions>
        <script location="component://materialmgmt/webapp/materialmgmt/WEB-INF/actions/reports/ListRequestsPerformFind.groovy"/>
          <service service-name="performFind" result-map="result" result-map-list="listIt">
            <field-map field-name="inputFields" from-field="parameters"/>
            <field-map field-name="entityName" from-field="entityName"/>
            <field-map field-name="orderBy" value="-custRequestDate"/>
            <!-- <field-map field-name="inputFields.fromPartyId" from-field="parameters.partyId" /> -->
            <field-map field-name="viewIndex" from-field="viewIndex"/>
            <field-map field-name="viewSize" from-field="viewSize"/>
          </service>
          <script location="component://production/webapp/production/WEB-INF/actions/ProductionRequestToPartyPerformFind.groovy"/>
        </actions>
    </form>

    <form name="ListProductionRequestList" type="list" use-row-submit="true" list-name="custRequests" title="List of customer requests"
        odd-row-style="alternate-row" header-row-style="header-row-2" default-table-style="basic-table hover-bar">
        <field name="custRequestId"  title="${uiLabelMap.MaterialMangement_CustRequestId}" widget-style="buttontext">
            <hyperlink description="${custRequestId}" target="ViewProductionRequest">
                <parameter param-name="custRequestId"/>
            </hyperlink>
        </field>
        <field name="custRequestDate"  title="${uiLabelMap.MaterialMangement_CustRequestDate}"><display description="${bsh:org.ofbiz.base.util.UtilDateTime.toDateString(custRequestDate,&quot;dd-MM-yyyy&quot;)}"/></field>
        <field name="fromPartyId"  title="${uiLabelMap.MaterialMangement_CustRequestFromPartyId}">
            <display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName}">
                <sub-hyperlink description="[${fromPartyId}]" target="/partymgr/control/viewprofile" target-type="inter-app">
                    <parameter param-name="partyId" from-field="fromPartyId"/>
                </sub-hyperlink>
            </display-entity>
        </field>
        <field name="partyIdFrom"  title="${uiLabelMap.MaterialMangement_CustRequestToPartyId}">
            <display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName}">
                <sub-hyperlink description="[${partyIdFrom}]" target="/partymgr/control/viewprofile" target-type="inter-app">
                    <parameter param-name="partyId" from-field="partyIdFrom"/>
                </sub-hyperlink>
            </display-entity>
        </field>
        <field name="custRequestName" title="${uiLabelMap.MaterialMangement_CustRequestName}"><display/></field>
        <field name="statusId"  title="Status">
            <display-entity also-hidden="false" entity-name="StatusItem"/>
        </field>
        <field name="lastModifiedDate" ><display description="${groovy:org.ofbiz.base.util.UtilDateTime.toDateString(lastModifiedDate, &quot;dd-MM-yyyy HH:mm:ss&quot;);}"/></field>
        <field name="createdByUserLogin" ><display/></field>
        <field use-when="&quot;${statusId}&quot;== &quot;CRQ_SUBMITTED&quot; &amp;&amp;${groovy:((security.hasEntityPermission(&quot;PRO&quot;, &quot;_CLOSE_INDENT&quot;, session)))}" name="close" title="Close Indent" widget-style="button" >
        	<hyperlink target="setRequestStatus" description="Close">
        		<parameter param-name="custRequestId"/>
                <parameter param-name="statusId" value="CRQ_COMPLETED"/>
        	</hyperlink>
        </field>
        <field use-when="&quot;${statusId}&quot;== &quot;CRQ_DRAFT&quot; &amp;&amp;((${groovy:((security.hasEntityPermission(&quot;PRO&quot;, &quot;_CANCEL_INDENT&quot;, session)))}) || (createdByUserLogin.equals(&quot;${userLogin.userLoginId}&quot;)))" name="cancel" widget-style="buttontext">
            <hyperlink target="setRequestStatus" description="Cancel">
                <parameter param-name="custRequestId"/>
                <parameter param-name="statusId" value="CRQ_CANCELLED"/>
            </hyperlink>
        </field>
    </form>
    <form name="ProductionRequestsToApprove" type="single" target="findProductionRequestsToApprove">
     <actions>
     </actions>
    	<field name="productId" title="Product">
             <lookup target-form-name="LookupProduct" size="15" />
        </field>
   		 <field name="custRequestId" title="${uiLabelMap.MaterialMangement_CustRequestId}"><text-find/></field>
   		  <field name="fromPartyId" title="From Department">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="finalDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
		<field name="partyIdFromDept" title="To Department">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="toDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
		<field name="custRequestDate" title="${uiLabelMap.MaterialMangement_CustRequestDate}"><date-time type="date"/></field>   
   		 <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit">
            <submit button-type="button"/>
        </field>
    </form>
    <form name="ListProductionRequestsToApprove" type="list" extends="ProductionRequestsToApproveList" list-name="listIt">
        <actions>
        <script location="component://materialmgmt/webapp/materialmgmt/WEB-INF/actions/reports/ListRequestsToApprovePerformFind.groovy"/>
          <service service-name="performFind" result-map="result" result-map-list="listIt">
            <field-map field-name="inputFields" from-field="parameters"/>
            <field-map field-name="entityName" from-field="entityName"/>
            <!-- <field-map field-name="inputFields.custRequestTypeId" value="INTERNAL_INDENT"/> -->
            <field-map field-name="inputFields.itemStatusId" value="CRQ_DRAFT"/>
            <!-- <field-map field-name="inputFields.fromPartyId" from-field="parameters.partyId" /> -->
            <field-map field-name="orderBy" value="-custRequestId"/>  
            <field-map field-name="viewIndex" from-field="viewIndex"/>
            <field-map field-name="viewSize" from-field="viewSize"/>
          </service>
          <script location="component://production/webapp/production/WEB-INF/actions/ProductionRequestToPartyPerformFind.groovy"/>
        </actions>
    </form>
    <form name="ProductionRequestsToApproveList" type="list" use-row-submit="true"  title="" list-name="custRequestItemsList"
        odd-row-style="alternate-row"  default-table-style="basic-table hover-bar"  separate-columns="true">
        <row-actions>
			<entity-one value-field="product" entity-name="Product">
				<field-map field-name="productId" from-field="productId"/>
			</entity-one>
			<entity-one value-field="uom" entity-name="Uom">
				<field-map field-name="uomId" from-field="product.quantityUomId"/>
			</entity-one>
			<set field="dec" from-field="uom.description"/>
		</row-actions>
        <field name="custRequestId" title="${uiLabelMap.MaterialMangement_CustRequestId}"><display/></field>
        <field name="custRequestItemSeqId" title="${uiLabelMap.MaterialMangement_CustRequestItemSeqId}"><display/></field>
        <field name="custRequestDate" title="${uiLabelMap.MaterialMangement_CustRequestDate}"><display description="${groovy:org.ofbiz.base.util.UtilDateTime.toDateString(custRequestDate, &quot;dd/MM/yyyy&quot;)}"/></field>
        <field name="fromPartyId" title="${uiLabelMap.MaterialMangement_CustRequestFromPartyId}">
            <display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName}"/>
        </field>
        <field name="partyIdFrom"  title="${uiLabelMap.MaterialMangement_CustRequestToPartyId}">
            <display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName}">
            </display-entity>
        </field>
        <field name="productId" title="${uiLabelMap.MaterialMangement_ProductId} - ${uiLabelMap.MaterialMangement_ProductName} [UOM]">
            <display-entity entity-name="Product" key-field-name="productId" description="${productId} - ${productName} [${dec}]"/>
        </field>
        <field name="requireQty" title="Required Qty"><display description="${quantity}"/></field>
        <field name="tempQty" title="Accepted Qty"><text default-value="${quantity}"></text></field>
        <field name="description" title="Description"  widget-style="required" required-field="false"  ><text size="25" /></field>
        <field name="rejectButton" widget-style="buttontext" event="onclick" action="javascript:rejectMaterialRequest(this);" >
        <submit/>
            <!-- <hyperlink target="rejectMaterialRequest" description="Reject">
                <parameter param-name="custRequestId"/>
                <parameter param-name="custRequestItemSeqId"/>
                <parameter param-name="description"/>
                <parameter param-name="statusId" value="CRQ_REJECTED"/>
            </hyperlink> -->
        </field>
        <field  name="acceptButton" event="onclick" action="javascript:approveRequestByHOD(this);" widget-style="buttontext" >
         <!-- <hyperlink target="" description="Accept">
                <parameter param-name="custRequestId"/>
                <parameter param-name="custRequestItemSeqId"/>
                <parameter param-name="Tempquantity" />
                <parameter param-name="description"/>
                <parameter param-name="statusId" value="CRQ_SUBMITTED"/>
         </hyperlink> -->
         <submit />
        </field>
        <field name="IndentHeadApproval"  title="Select" > <check all-checked="false" > <option key="${custRequestId}_${custRequestItemSeqId}_${tempQty}_${description}" description=" "  ></option></check> </field>
    </form> 
     <form name="FindProductionIssuance" target="findProductionIssuance" title="" type="single" default-map-name="parameters"
        header-row-style="header-row" default-table-style="basic-table">
        <actions>
        </actions>
        <field name="itemIssuanceId" title="Issuance Id"><text-find/></field>
        <!-- <field name="shipmentId" title="Shipment Id"><text-find/></field> -->
        <field name="custRequestId" title="${uiLabelMap.MaterialMangement_CustRequestId}"><text-find/></field>
        <field name="custRequestName" title="${uiLabelMap.MaterialMangement_CustRequestName}"><text-find/></field>
        <!-- <field name="fromPartyId" title="${uiLabelMap.MaterialMangement_CustRequestFromPartyId}"><lookup target-form-name="LookupPartyName"/></field> -->
 		<field name="productId" title="Product">
             <lookup target-form-name="LookupProduct" size="15" />
        </field>
 		<field name="fromPartyId" title="Requested Department">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="toDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
		<field name="partyFrom" title="Issue Department">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="finalDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
 		<field name="custRequestDate" title="${uiLabelMap.MaterialMangement_CustRequestDate}"><date-find/></field>
 		<field name="issueDate" title="${uiLabelMap.MaterialMangement_IssuedDate}"><date-find/></field>
 		<!-- <field name="shipmentTypeId" ><hidden value="PRODUCTION_SHIPMENT"/> </field> -->
 		<!-- <field name="statusId" ><hidden value="GENERATED"/> </field> -->
        <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit">
            <submit button-type="button"/>
        </field>
        <field name="noConditionFind"><hidden value="Y"/><!-- if this isn't there then with all fields empty no query will be done --></field>
    </form>
    <form name="ListProductionIssuance" type="list" extends="ProductionIssuanceList" list-name="listIt">
    	<actions>
          <service service-name="performFind" result-map="result" result-map-list="listIt">
            <field-map field-name="inputFields" from-field="parameters"/>
            <field-map field-name="entityName" value="IssuanceAndShipmentAndCustRequest"/>
            <field-map field-name="orderBy" value="-issueDate"/>
            <field-map field-name="inputFields.custRequestTypeId" value="INTERNAL_INDENT"/>
            <field-map field-name="inputFields.statusId" value="GENERATED"/>
            <field-map field-name="inputFields.shipmentTypeId" value="PRODUCTION_SHIPMENT"/>
            <field-map field-name="viewIndex" from-field="viewIndex"/>
            <field-map field-name="viewSize" from-field="viewSize"/>
          </service>
          <script location="component://production/webapp/production/WEB-INF/actions/ProductionIssuanceToPartyPerformFind.groovy"/>
        </actions>
    </form>
    <form name="ProductionIssuanceList" type="list"  list-name="listIt" title="List of customer requests" separate-columns="true"
        odd-row-style="alternate-row" header-row-style="header-row-2" default-table-style="basic-table hover-bar">
       <row-actions>
          <entity-one entity-name="CustRequestItem" auto-field-map="true">
       		<select-field field-name="statusId"/>
       	  </entity-one>
        	<set field="crqItemstatusId" from-field="statusId"/>
        	<entity-one value-field="product" entity-name="Product">
				<field-map field-name="productId" from-field="productId"/>
			</entity-one>
			<entity-one value-field="uom" entity-name="Uom">
				<field-map field-name="uomId" from-field="product.quantityUomId"/>
			</entity-one>
			<set field="dec" from-field="uom.description"/>
       </row-actions>
        <field name="itemIssuanceId" title="Issuance Id"><display/></field>
        <field name="custRequestId" title="${uiLabelMap.MaterialMangement_CustRequestId}">
			<display/>
        </field>
        <field name="custRequestItemSeqId" title="Indent Item No">
			<display/>
        </field>
        <field name="custRequestDate" title="${uiLabelMap.MaterialMangement_CustRequestDate}"><display description="${groovy:org.ofbiz.base.util.UtilDateTime.toDateString(custRequestDate,&quot;dd/MM/yyyy&quot;)}"/></field>
        <field name="fromPartyId" title="Requested Department">
        	<display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName}"/>
        </field>
        <field name="partyIdFrom" title="Issue Department">
        	<display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName}"/>
        </field>
        <field name="custRequestName" title="${uiLabelMap.MaterialMangement_CustRequestName}"><display/></field>
        <field name="productId" title="${uiLabelMap.MaterialMangement_ProductId} - ${uiLabelMap.MaterialMangement_ProductName} [UOM]">
        	<display-entity entity-name="Product" description="${productId} - ${description} [${dec}]"/>
        </field>
        <field name="quantity" title="Issued Quantity"><display/></field>
        <field name="issueDate" title="Issue Date"><display description="${groovy:org.ofbiz.base.util.UtilDateTime.toDateString(issueDate,&quot;dd/MM/yyyy HH:mm:ss&quot;)}"/></field>
        <field name="issuedByUserLoginId" title="Issued By"><display/></field>
        <!--  <field name="crqItemstatusId" title="crqItemstatusId-"><display/></field>  -->
        <field  use-when="&quot;${crqItemstatusId}&quot; != &quot;CRQ_COMPLETED&quot;" name="cancelIssue" widget-style="buttontext">
            <hyperlink target="cancelProductionIssuenceForCustRequest" description="CancelIssue" confirmation-message="Are you sure to Cancel Issuance..?">
                <parameter param-name="custRequestId"/>
                 <parameter param-name="custRequestItemSeqId"/>
                 <parameter param-name="itemIssuanceId"/>
                   <parameter param-name="shipmentId"/>
            </hyperlink>
        </field> 
        <!-- <field name="report" title="Report" widget-style="buttontext">
        	<hyperlink target="ItemIssuanceReport.pdf" description="Report" target-window="_blank">
        		<parameter param-name="custRequestId"/>
        		<parameter param-name="custRequestItemSeqId"/>
        		<parameter param-name="itemIssuanceId"/>
        		<parameter param-name="flag" value="itemIssuance"/>
        	</hyperlink>
        </field> -->
    </form>
    <form name="FindProductionIssueRequests" type="single" target="findProductionIssueRequests">
        <actions>
          <!-- <set field="partyFrom" from-field="partyId"/> -->
        </actions>
   		<field name="productId" title="Product">
             <lookup target-form-name="LookupProduct" size="15" />
        </field>
   		 <field name="custRequestId" title="${uiLabelMap.MaterialMangement_CustRequestId}"><text-find/></field>
		<field name="fromPartyId" title="Requested Department">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="toDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
		<field name="partyFrom" title="Issue Department">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="finalDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
		<field name="custRequestDate" title="${uiLabelMap.MaterialMangement_CustRequestDate}"><date-time type="date"/></field>   
   		 <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit">
            <submit button-type="button"/>
        </field>
   </form>
   <form name="ListProductionIssueRequests" type="list" use-row-submit="true"  title="" list-name="custRequestItemsList" separate-columns="true"
        odd-row-style="alternate-row" default-table-style="basic-table hover-bar"  paginate-target="StoreProductIssue">
        <row-actions>
            <set field="flag" value="N"/>
        	<!-- <set field="flag" value="${groovy: return (QOH > 0)? 'Y' : 'N';}"/>
        	<set field="custmQuantity" value="${quantity-(QOH+issuedQty)}"/>
        	<set field="toBeIssuedQty" value="${groovy: return (quantity-issuedQty > QOH)?  QOH: (quantity-issuedQty);}"/> -->
        	<entity-one value-field="product" entity-name="Product">
				<field-map field-name="productId" from-field="productId"/>
			</entity-one>
			<entity-one value-field="uom" entity-name="Uom">
				<field-map field-name="uomId" from-field="product.quantityUomId"/>
			</entity-one>
			<set field="dec" from-field="uom.description"/>
			<entity-and entity-name="Facility"  list="facilitiesList">
				<field-map field-name="ownerPartyId" from-field="partyIdFrom"/>
			</entity-and>
			<set field="facilityIds" value="${groovy:org.ofbiz.entity.util.EntityUtil.getFieldListFromEntityList(facilitiesList, 'facilityId', true);}" type="List"/>
			<entity-condition entity-name="ProductFacility" list="proFacilityList">
				<condition-list combine="and">
					<condition-expr field-name="productId" operator="equals" from-field="productId"/>
					<condition-expr field-name="facilityId" operator="in" from-field="facilityIds"/>
				</condition-list>
			</entity-condition>
			<set field="prodFacilityIds" value="${groovy:org.ofbiz.entity.util.EntityUtil.getFieldListFromEntityList(proFacilityList, 'facilityId', true);}" type="List"/>
			<entity-condition entity-name="Facility" list="finalFacilityList">
				<condition-expr field-name="facilityId" operator="in" from-field="prodFacilityIds"/>
			</entity-condition>
        </row-actions>
        <field name="shipmentTypeId"><hidden value="PRODUCTION_SHIPMENT"/></field>
        <field name="custRequestId" title="${uiLabelMap.MaterialMangement_CustRequestId}" widget-style="buttontext">
        <hyperlink description="${custRequestId}" target="ViewProductionRequest">
                <parameter param-name="custRequestId"/>
            </hyperlink>
        </field>
        <field name="custRequestItemSeqId" ><hidden/></field>
        <field name="custRequestDate" title="${uiLabelMap.MaterialMangement_CustRequestDate}"><display description="${groovy:org.ofbiz.base.util.UtilDateTime.toDateString(custRequestDate, &quot;dd/MM/yyyy&quot;)}"/></field>
        <field name="fromPartyId" title="Requested Department">
            <display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName}"/>
        </field>
        <field id-name="partyIdFrom" name="partyIdFrom" title="Issue Department">
            <display-entity entity-name="PartyNameView" key-field-name="partyId" description="${firstName} ${middleName} ${lastName} ${groupName}"/>
        </field>
        <field id-name="productId" name="productId" title="${uiLabelMap.MaterialMangement_ProductId} - ${uiLabelMap.MaterialMangement_ProductName} [UOM]">
            <display-entity entity-name="Product" key-field-name="productId" description="${productId} - ${productName} [${dec}]"/>
        </field>
        <field name="facilityId" title="facility" event="onchange" action="javascript:getInvAvailBalance(this);"><drop-down allow-empty="true"><list-options key-name="facilityId" list-name="finalFacilityList" description="${facilityName}"/></drop-down></field>
        <field name="statusId" title="Status" ><display-entity entity-name="StatusItem" description="${description}"></display-entity> </field>
         <field name="quantity" title="Req. Qty"><display/></field>
          <field name="issuedQty" title="IssuedQty" ><display/></field>  
         <field name="QOH" title="Inv. Available" ><text default-value="0" size="6" read-only="true"></text> </field>
        <field name="tempQty" title="QtyToIssue" ><text size="5"  default-value="0"> </text></field>
        <field id-name="checkIssuance" name="checkIssuance"  title="Select" use-when="showTransferButton == &quot;N&quot;" > <check all-checked="false" > <option key="${custRequestId}_${custRequestItemSeqId}_${tempQty}_${shipmentTypeId}" description=" " ></option></check> </field>
        <field name="issueThruTransfer" widget-style="buttontext" title="Issue thru Transfers" use-when= "showTransferButton == &quot;Y&quot;" event="onclick" action="javascript:setFormValues(this);">
            <!-- <display  description="Transfer"/> -->
            <hyperlink target-type="plain" target="javascript:showProductFacilityAvailableForm('${custRequestId}','${custRequestItemSeqId}','${fromPartyId}','${productId}','${quantity}','${issuedQty}','${tempQty}');" description="Issue thru Transfer">
            </hyperlink>
        </field>
        <field use-when="&quot;${statusId}&quot;== &quot;CRQ_SUBMITTED&quot; &amp;&amp;${groovy:((security.hasEntityPermission(&quot;PRO&quot;, &quot;_CLOSE_INDENT&quot;, session)))}" name="close" title="Close" widget-style="button" >
        	<hyperlink target="setRequestItemStatus" description="Close">
        		<parameter param-name="custRequestId"/>
        		<parameter param-name="custRequestItemSeqId"/>
                <parameter param-name="statusId" value="CRQ_COMPLETED"/>
        	</hyperlink>
        </field>
    </form>
    <form name="SearchReceiptAcknowledgement" type="single" target="searchReceiptAcknowledgement">
    	<field name="productId" title="Product">
             <lookup target-form-name="LookupProduct" size="15" />
        </field>
   		 <field name="custRequestId" title="${uiLabelMap.MaterialMangement_CustRequestId}"><text-find/></field>
   		  <field name="fromPartyId" title="From Department">
			<drop-down allow-empty="true" >
				<list-options key-name="partyId" list-name="finalDepartmentList" description="${groupName}"/>
			</drop-down>
		</field>
		<field name="custRequestDate" title="${uiLabelMap.MaterialMangement_CustRequestDate}"><date-time type="date"/></field>   
   		 <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit">
            <submit button-type="button"/>
        </field>
    </form>
    <form name="SearchProductionTempRecord" type="single" target="FindProductionTempRecord">
      <field name="noConditionFind"><hidden value="Y"/><!-- if this isn't there then with all fields empty no query will be done --></field>
      <field name="facilityId">
      	<drop-down allow-empty="true">
      	  <list-options key-name="facilityId" list-name="facilityGroupAndMemberAndFacility" description="${description}"/>
      	</drop-down>
      </field>
      <field name="recordDateTime" > <date-find/></field>
      <!-- <field name="date"><date-time type="date"/></field> -->
      <field name="shiftTypeId" title="Shift"><drop-down allow-empty="true"><entity-options description="${description}" key-field-name="shiftTypeId" entity-name="WorkShiftType">
      	<entity-constraint name="parentTypeId" operator="equals" value="PROD_SHIFT"/>
      </entity-options></drop-down></field>
      <field name="temperature"><text-find></text-find></field>
      <field name="comments"><text-find></text-find></field>
      <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit">
            <submit button-type="button"/>
        </field>
    </form>
    <form name="ListProductionTempRecords" type="list" use-row-submit="true"  title="" list-name="listIt" separate-columns="true" target="deleteFacilityTemperature"
        odd-row-style="alternate-row" header-row-style="header-row-2" default-table-style="basic-table hover-bar"  >
    	<actions>
    		<service service-name="performFind" result-map="result" result-map-list="listIt">
            <field-map field-name="inputFields" from-field="parameters"/>
            <field-map field-name="entityName" value="FacilityTemperature"/>
            <field-map field-name="orderBy" value="-recordDateTime"/>
            <field-map field-name="viewIndex" from-field="viewIndex"/>
            <field-map field-name="viewSize" from-field="viewSize"/>
          </service>
          <script location="component://production/webapp/production/WEB-INF/actions/ProductionFacilityTempPerformFind.groovy"/>
    	</actions>
    	<field name="facilityId"><display-entity entity-name="Facility" ></display-entity></field>
    	<field name="temperature"><display></display></field>
    	<field name="recordDateTime"><display description="${groovy:org.ofbiz.base.util.UtilDateTime.toDateString(recordDateTime,&quot;dd:MM:yyyy HH:mm&quot;)}"/></field>
    	<field name="shiftTypeId" title="Shift"><display-entity entity-name="WorkShiftType" description="${description}"></display-entity></field>
    	<field name="comments"><display></display></field>
    	<field name="deleteRecode" title="Delete"  widget-style="smallSubmit">
    	 <submit/>
    	</field>
    </form>
    
</forms>