<link type="text/css" href="<@ofbizContentUrl>/images/jquery/ui/css/ui-lightness/jquery-ui-1.8.13.custom.css</@ofbizContentUrl>" rel="Stylesheet" />	

<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../excanvas.min.js"></script><![endif]-->

<script  language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/flot/jquery.flot.js</@ofbizContentUrl>"></script>
<script  language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/flot/jquery.flot.axislabels.js"</@ofbizContentUrl>></script>

<script  language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/flot/jquery.flot.pie.js"</@ofbizContentUrl>></script>
<script  language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/flot/jquery.flot.tooltip.js"</@ofbizContentUrl>></script>
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/slick.grid.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/controls/slick.pager.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/examples/examples.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/controls/slick.columnpicker.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />


<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/lib/firebugx.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/lib/jquery-ui-1.8.5.custom.min.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/lib/jquery.event.drag-2.0.min.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/slick.core.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/slick.editors.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/plugins/slick.cellrangedecorator.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/plugins/slick.cellrangeselector.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/plugins/slick.cellselectionmodel.js</@ofbizContentUrl>"></script>		
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/slick.grid.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/slick.groupitemmetadataprovider.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/slick.dataview.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/controls/slick.pager.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/controls/slick.columnpicker.js</@ofbizContentUrl>"></script>


<link rel="stylesheet" href="<@ofbizContentUrl>/images/amcharts/style.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/controls/slick.pager.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/css/smoothness/jquery-ui-1.8.5.custom.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/examples/examples.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/controls/slick.columnpicker.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
        		
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/amcharts/amcharts.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/amcharts/pie.js</@ofbizContentUrl>"></script>


<link rel="stylesheet" href="<@ofbizContentUrl>/images/amcharts/style.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/controls/slick.pager.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/css/smoothness/jquery-ui-1.8.5.custom.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/examples/examples.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="<@ofbizContentUrl>/images/jquery/plugins/slickgrid/controls/slick.columnpicker.css</@ofbizContentUrl>" type="text/css" media="screen" charset="utf-8" />
        		
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/amcharts/amcharts.js</@ofbizContentUrl>"></script>
<script language="javascript" type="text/javascript" src="<@ofbizContentUrl>/images/amcharts/serial.js</@ofbizContentUrl>"></script>

<script type="application/javascript">
    
            var chart;
			var data = ${StringUtil.wrapString(categorySiloJSON)!'[]'};
			var gridData1 = ${StringUtil.wrapString(facilityFloorJSON)!'[]'};
			var gridData2 = ${StringUtil.wrapString(facilityStorageJSON)!'[]'};
			
			
			var chartData1;
			var chartData2;
			var chartData3;
			var chartData4;
			var chartData5;
			var chartData6;
			var chartData7;
			var chartData8;
			<#assign i = 1>
			<#list categoryList as eachCategory>
				<#assign chartData = "chartData"+i>
				<#assign catId = eachCategory.siloType />
				${chartData} = data["${catId}"];
				<#assign i = i+1>
			</#list>			
			AmCharts.ready(function () {
				<#if categoryList?exists && categoryList?has_content>
					
					// serial chart
					<#assign i = 1>	
					<#list categoryList as eachCategory>
						<#assign catId = eachCategory.siloType />
						<#assign chartData = "chartData"+i>
						<#assign chart = "chart"+i>
						var ${chart} = new AmCharts.AmSerialChart();
		                ${chart}.dataProvider = ${chartData};
		                ${chart}.categoryField = "facility";
		                ${chart}.startDuration = 1;
		                ${chart}.depth3D = 50;
		                ${chart}.angle = 30;
		                ${chart}.marginRight = -45;
		                <#assign i = i+1>
		            </#list>    
		        		// AXES
                		// category
		            <#assign i = 1>	
					<#list categoryList as eachCategory>
					    <#assign chart = "chart"+i>
					    <#assign categoryAxis = "categoryAxis"+i>
		                var ${categoryAxis} = ${chart}.categoryAxis;
		                ${categoryAxis}.gridAlpha = 0;
		                ${categoryAxis}.axisAlpha = 0;
		                ${categoryAxis}.gridPosition = "start";
						<#assign i = i+1>
		            </#list>
					
						// value
					<#assign i = 1>	
					<#list categoryList as eachCategory>
					    <#assign chart = "chart"+i>
		                <#assign valueAxis = "valueAxis"+i>
		                var ${valueAxis} = new AmCharts.ValueAxis();
		                ${valueAxis}.axisAlpha = 0;
		                ${valueAxis}.gridAlpha = 0;
		                ${chart}.addValueAxis(${valueAxis});
						<#assign i = i+1>
		            </#list>
						
						// GRAPH
					<#assign i = 1>	
					<#list categoryList as eachCategory>
					    <#assign chart = "chart"+i>
		            	<#assign graph = "graph"+i>
		                var ${graph} = new AmCharts.AmGraph();
		                ${graph}.valueField = "quantity";
		                ${graph}.colorField = "color";
		                ${graph}.balloonText = "<b>Silo: [[category]] </br>Qty: [[value]]</br> Product: [[productName]] </br>Capacity: [[capacity]] </b>";
		                ${graph}.type = "column";
		                ${graph}.lineAlpha = 0.5;
		                ${graph}.lineColor = "#FFFFFF";
		                ${graph}.columnWidth = 0.5;
		                ${graph}.topRadius = 1;
		                ${graph}.fillAlphas = 0.8;
		                ${chart}.addGraph(${graph});
						<#assign i = i+1>
		            </#list>
		            
						// CURSOR
					<#assign i = 1>	
					<#list categoryList as eachCategory>
					    <#assign chart = "chart"+i>
		                <#assign chartCursor = "chartCursor"+i>
		                var ${chartCursor} = new AmCharts.ChartCursor();
		                ${chartCursor}.cursorAlpha = 0;
		                ${chartCursor}.zoomable = false;
		                ${chartCursor}.categoryBalloonEnabled = false;
		                ${chartCursor}.valueLineEnabled = false;
		                ${chartCursor}.valueLineBalloonEnabled = false;
		                ${chartCursor}.valueLineAlpha = 1;
		                ${chart}.addChartCursor(${chartCursor});
		                <#assign i = i+1>
					</#list>
					<#assign i = 1>
					<#list categoryList as eachCategory>
						<#assign chartdiv = "chartdiv"+i>
						<#assign chart = "chart"+i>
						${chart}.write("${chartdiv}");
						<#assign i = i+1>
					</#list>
				</#if>
            });
			
			var legend;
			var legendData = ${StringUtil.wrapString(facilityInvSummaryJSON)!'[]'};

            AmCharts.ready(function () {
                // PIE CHART
                chartLegend = new AmCharts.AmPieChart();
                chartLegend.dataProvider = legendData;
                chartLegend.titleField = "productName";
                chartLegend.valueField = "quantity";
				chartLegend.depth3D = 10;
            	chartLegend.angle = 20;
            	chartLegend.labelText = "[[value]]";
            	chartLegend.labelRadius = -30;
            	chartLegend.sequencedAnimation = true;
                chartLegend.startEffect = "elastic";
                chartLegend.innerRadius = "30%";
                chartLegend.startDuration = 2;
                
                
                // LEGEND
                legend = new AmCharts.AmLegend();
                legend.align = "center";
                legend.markerType = "triangleUp";
                legend.maxColumns = 1;
                legend.position = "top";
                chartLegend.balloonText = "[[title]]<br><span style='font-size:14px'><b>[[value]]</b></span>";
                
				chartLegend.addLegend(legend, "summaryLegend");
                // WRITE
                chartLegend.write("chartMoveDiv");
            });
			
// to show special related fields in form			
	function setupGrid1() {
		var grid;
		var data = gridData1;
		var dataView ;

		var columns = [
			{id:"product", name:"Product", field:"product", width:220, minWidth:220, cssClass:"cell-title", focusable: false, sortable:false},	
			{id:"quantity", name:"Available", field:"quantity", width:80, minWidth:80, cssClass:"cell-title-right", focusable: false, sortable:false}	
		];
		
		var options = {
			editable: false,		
			forceFitColumns: true,
			enableCellNavigation: true,
			asyncEditorLoading: false,			
			autoEdit: false,
            secondaryHeaderRowHeight: 25
		};
		
        var groupItemMetadataProvider = new Slick.Data.GroupItemMetadataProvider();
		dataView = new Slick.Data.DataView({
        	groupItemMetadataProvider: groupItemMetadataProvider
        });
		grid = new Slick.Grid("#myGrid1", dataView, columns, options);
        grid.setSelectionModel(new Slick.CellSelectionModel());
		var columnpicker = new Slick.Controls.ColumnPicker(columns, grid, options);
		
		// wire up model events to drive the grid
		dataView.onRowCountChanged.subscribe(function(e,args) {
			grid.updateRowCount();
            grid.render();
		});
		dataView.onRowsChanged.subscribe(function(e,args) {
			grid.invalidateRows(args.rows);
			grid.render();
		});
        
		// initialize the model after all the events have been hooked up
		dataView.beginUpdate();
		dataView.setItems(data);
		dataView.endUpdate();

	}
	function setupGrid2() {
		var grid;
		var data1 = gridData2;
		var dataView ;

		var columns = [
			{id:"facility", name:"Facility", field:"facility", width:80, minWidth:80, cssClass:"cell-title", focusable: false,sortable:false},
			{id:"product", name:"Product", field:"product", width:220, minWidth:220, cssClass:"cell-title", focusable: false, sortable:false},	
			{id:"quantity", name:"Available", field:"quantity", width:80, minWidth:80, cssClass:"cell-title-right", focusable: false, sortable:false}	
		];
		
		var options = {
			editable: false,		
			forceFitColumns: true,
			enableCellNavigation: true,
			asyncEditorLoading: false,			
			autoEdit: false,
            secondaryHeaderRowHeight: 25
		};
		
        var groupItemMetadataProvider = new Slick.Data.GroupItemMetadataProvider();
		dataView = new Slick.Data.DataView({
        	groupItemMetadataProvider: groupItemMetadataProvider
        });
		grid = new Slick.Grid("#myGrid2", dataView, columns, options);
        grid.setSelectionModel(new Slick.CellSelectionModel());
		var columnpicker = new Slick.Controls.ColumnPicker(columns, grid, options);
		
		// wire up model events to drive the grid
		dataView.onRowCountChanged.subscribe(function(e,args) {
			grid.updateRowCount();
            grid.render();
		});
		dataView.onRowsChanged.subscribe(function(e,args) {
			grid.invalidateRows(args.rows);
			grid.render();
		});
        
		// initialize the model after all the events have been hooked up
		dataView.beginUpdate();
		dataView.setItems(data1);
		dataView.endUpdate();

	}
	$(document).ready(function(){
		<#if facilityFloorJSON?has_content>
			setupGrid1();
		</#if>
		<#if facilityStorageJSON?has_content>
			setupGrid2();
		</#if>
		
	});	 
</script>			
<div class="full">
<div class="screenlet">
	<div class="screenlet-title-bar">
      	<h3>Search Field</h3>	
     </div>
    <div class="screenlet-body">
	  <form name="siloInventoryForm" method="post" action="productionDashboardMain">
		<table class="basic-table" cellspacing="0" width="30%">
			<tr>
        		<td align="right" width="10%"><span class='h3'>Plant/Unit: </span></td>
				<td align="left" width="10%">
					<select name="facilityId" class='h3'>
						<#list facilityList  as eachFac>
							<#if extFacilityId?exists && eachFac.facilityId == extFacilityId>
								<option value='${eachFac.facilityId}' selected='selected'>${eachFac.facilityName?if_exists}</option>
							<#else>
								<option value='${eachFac.facilityId}'>${eachFac.facilityName?if_exists}</option>
							</#if>
						</#list>
					</select>
				</td>
				<td align="center" width="10%"><input type="submit" value="Submit" id="getCharts" class="smallSubmit" /></td>
			</tr>
    	</table> 
		</form>
	</div>
</div>
</div>
<div class="full">
	<#if categoryList?has_content>
		<div class="screenlet-title-bar">
     		<div class="grid-header" style="width:100%">
				<center><label>Inventory Summary</label><center>
			</div>
	     </div>
	
	
	     <div class="screenlet-body">
	     	<div class="lefthalf">
	     		<div id="summaryLegend" style="width: 100%; height: 250px;"></div>
	     	</div>
	     	<div class="righthalf">
	     		<div id="chartMoveDiv" style="width: 100%; height: 250px;"></div>
			</div>
	     </div>
	</#if>
</div>
<div class="clear"></div>
<div class="full">
	<#if facilityFloorJSON?has_content>
 		<div class="lefthalf">
 		
			<div class="screenlet">
				<div class="screenlet-title-bar">
	         		<div class="grid-header" style="width:100%;margin-right:10px;">
						<center><label>Production Floor</label><center>
					</div>
			     </div>
			     
			     <div class="screenlet-body">
			     	<div id="myGrid1" style="width:100%;height:250px;margin-right:10px;"></div>
			     </div>
			</div>
		</div>
	</#if>
	<#if facilityStorageJSON?has_content>
 		<div class="righthalf">
 		
			<div class="screenlet">
				<div class="screenlet-title-bar">
	         		<div class="grid-header" style="width:100%;margin-right:10px;">
						<center><label>Defreezers</label><center>
					</div>
			     </div>
			     
			     <div class="screenlet-body">
			     	<div id="myGrid2" style="width:100%;height:250px;margin-right:10px;"></div>
			     </div>
			</div>
		</div>
	</#if>
</div>
<div class="clear"></div>
<div class="full">
	<#if categoryList?has_content>
		<#assign index = 1>
 		 <#list categoryList as eachSilo>
 		 		<div class="full">
 		 		
					<div class="screenlet">
						<div class="screenlet-title-bar">
			         		<div class="grid-header" style="width:100%">
								<center><label>${eachSilo.description?if_exists}</label><center>
							</div>
					     </div>
					     
					     <div class="screenlet-body">
					     	<#assign idx= "chartdiv"+index>
					     		<div id="${idx}" style="width: 100%; height: 250px;"></div>
					     </div>
					  </div>
				</div>
				<#assign index = index+1>
         </#list>    
	</#if>
</div>
