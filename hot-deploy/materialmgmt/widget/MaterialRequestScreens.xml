<?xml version="1.0" encoding="UTF-8"?>
<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">

    <screen name="FindMaterialRequest">
        <section>
            <actions>
                <set field="titleProperty" value="Requests"/>
                <set field="headerItem" value="request"/>
                <set field="tabButtonItem" value="FindMaterialRequest" />	
			    <set field="tabButtonItem2" value="FindMaterialRequest"/> 
                <set field="entityName" value="CustRequest"/>
            </actions>
            <widgets>
                <decorator-screen name="materialmgmtNgCommonDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                    	<include-menu name="RequestTabBar" location="component://materialmgmt/widget/materialmgmtMenus.xml"/>
                        <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                            <decorator-section name="search-options">
                                <include-form name="FindMaterialRequest" location="component://materialmgmt/widget/MaterialRequestForms.xml"/>
                            </decorator-section>
                            <decorator-section name="search-results">
                                <include-form name="ListRequests" location="component://materialmgmt/widget/MaterialRequestForms.xml"/>
                            </decorator-section>
                        </decorator-screen>
                    </decorator-section>
                </decorator-screen>
            </widgets>
         </section>
    </screen>
    
    <screen name="StoreProductIssue">
        <section>
            <actions>
                <set field="titleProperty" value="Issue"/>
                <set field="headerItem" value="Issue"/>
                <set field="tabButtonItem" value="StoreProductIssue" />	
                <script location="component://materialmgmt/webapp/materialmgmt/WEB-INF/actions/purchases/RequestAvailableProductList.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="materialmgmtNgCommonDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                     	<screenlet title="List Requests to Issue">
                     		<include-form name="ListRequestsToIssue" location="component://materialmgmt/widget/MaterialRequestForms.xml"/>
                     	</screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
         </section>
    </screen>
    
    <screen name="ApproveRequestsByDeptHead">
        <section>
            <actions>
                <set field="titleProperty" value="Issue"/>
                <set field="headerItem" value="Issue"/>
                <set field="tabButtonItem" value="FindMaterialRequest" />
                <set field="tabButtonItem2" value="ApproveRequestsByDeptHead" />
                
                <entity-condition list="custRequestItemsList" entity-name="CustRequestAndItemAndAttribute">
                	<condition-list combine="and">
                		<condition-list combine="or">
                			<condition-expr field-name="statusId" operator="equals" value="CRQ_DRAFT"/>
                			<condition-expr field-name="statusId" operator="equals" value="CRQ_SUBMITTED"/>
                		</condition-list>
						<condition-expr field-name="itemStatusId" operator="equals" value="CRQ_DRAFT"/>
						<condition-expr field-name="custRequestTypeId" operator="equals" value="PRODUCT_REQUIREMENT"/>                	
                	</condition-list>
                </entity-condition>	
            </actions>
            <widgets>
                <decorator-screen name="materialmgmtNgCommonDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                     	<include-menu name="RequestTabBar" location="component://materialmgmt/widget/materialmgmtMenus.xml"/>
                     	<screenlet title="List Requests to Approve">
                     		<include-form name="ListRequestsToApprove" location="component://materialmgmt/widget/MaterialRequestForms.xml"/>
                     	</screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
         </section>
    </screen>
    
    <screen name="CustRequestEntry">
        <section>
            <actions>
               <set field="titleProperty" value="Request Entry"/>              
			   <set field="tabButtonItem" value="FindMaterialRequest" />	
			   <set field="tabButtonItem2" value="CustRequestEntry"/>  
               <set field="supplyDate" from-field="parameters.supplyDate"/>
               <set field="isFormSubmitted" from-field="parameters.isFormSubmitted"/>
               <set field="defaultEffectiveDateTime" value="${supplyDate}" default-value="${bsh:org.ofbiz.base.util.UtilDateTime.nowTimestamp()}"/>
			   <set field="defaultEffectiveDate" 
					value="${groovy:org.ofbiz.base.util.UtilDateTime.toDateString(defaultEffectiveDateTime, &quot;dd MMMMM, yyyy&quot;);}" />
			   <set field="parameters.roleTypeId" value="INTERNAL_ORGANIZATIO"/>
				<set field="productCategoryResult" value="${groovy:org.ofbiz.product.product.ProductWorker.getProductsByCategoryAssoc(delegator, 'INDENT_PROD_CAT', 'PUR_INDENT', null)}" />
				<set field="categoryList" value="${productCategoryResult.productCategory}"/>		
			   					  					  
            </actions>
            <widgets>
            <decorator-screen name="materialmgmtNgCommonDecorator" location="${parameters.mainDecoratorLocation}">
            	<decorator-section name="body">   
                	<include-menu name="RequestTabBar" location="component://materialmgmt/widget/materialmgmtMenus.xml"/>
                      	<section>
	                      	  <condition>
	                             <if-compare operator="equals" field="isFormSubmitted" value=""/>
	                         </condition>
	                      		<widgets>
	           						<include-screen name="RequestInitEntry"/>
	                      		</widgets>
                      	</section>
                      <section>
                      <condition>
                      <if-compare operator="equals" field="isFormSubmitted" value="YES"/>
                      </condition>
                         <widgets>
     						 <include-screen name="RequestInnerScreen"/>
                		</widgets>
                      </section>
                      
                    </decorator-section>                                       
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="RequestInitEntry">
        <section>
            <actions>
                
               <entity-one value-field="showBoothAutoSuggestConf" entity-name="TenantConfiguration">
               		<field-map field-name="propertyTypeEnumId" value="FACILITY_AUTOSUGGEST"/>
               		<field-map field-name="propertyName" value="showBoothAutoSuggest"/>
               		<select-field field-name="propertyValue"/>
               </entity-one>
               <set field="showBoothAutoSuggest" value="${showBoothAutoSuggestConf.propertyValue}"/>
               <set field="supplyDate" from-field="parameters.supplyDate"/>
               <set field="effectiveDate" value="${parameters.effectiveDate}"/>
               <!-- <set field="checkListType" value="indentEntry"/> -->
               <!-- <set field="shipmentTypeId" value="${parameters.shipmentTypeId}"/> -->
                <entity-condition entity-name="Product" list="productList" use-cache="true">
                </entity-condition>                
                <script location="component://byproducts/webapp/byproducts/WEB-INF/actions/facility/enablePartyAutoComplete.groovy"/>
            </actions>
            <widgets>
               	<section>
                 	 <widgets>
          					<platform-specific><html><html-template location="component://materialmgmt/webapp/materialmgmt/purchase/RequestEntry.ftl"/></html></platform-specific>
                     </widgets>
                     <fail-widgets>
						<label style="h3">${uiLabelMap.ProductFacilityViewPermissionError}
						</label>
					</fail-widgets>
             	</section>                  
            </widgets>
        </section>
    </screen>
    
    <screen name="RequestInnerScreen">
        <section>
            <actions>
            	<set field="changeFlag" from-field="changeFlag"/>  
                <set field="checkListType" value="indentEntry"/>
                <set field="effectiveDate" value="${parameters.effectiveDate}"/>
                <set field="productCategoryId" from-field="parameters.productCategoryId"/>
                <set field="custRequestName" from-field="parameters.custRequestName"/>
                <script location="component://byproducts/webapp/byproducts/WEB-INF/actions/facility/AdhocIndentForm.groovy"/>
                <script location="component://byproducts/webapp/byproducts/WEB-INF/actions/facility/EditStoreOrderForm.groovy"/>
            </actions>
            <widgets>
                   <section>
               	   <condition>
               			<and>                     		
          					<if-has-permission permission="BYPRODUCTS" action="_INDENT"/>
              					<not><if-empty field="booth"/></not>
               			</and>
               		</condition> 
                       	<widgets>
                       	    <platform-specific><html><html-template location="component://materialmgmt/webapp/materialmgmt/purchase/RequestEntry.ftl"/></html></platform-specific>
                        </widgets>
                       <fail-widgets>
                           <platform-specific><html><html-template location="component://materialmgmt/webapp/materialmgmt/purchase/RequestEntry.ftl"/></html></platform-specific>								                           
                       </fail-widgets>
                   </section>
            </widgets>
        </section>
    </screen>
    
    <screen name="ViewCustRequest">
        <section>
            <actions>
                <set field="custRequestId" from-field="parameters.custRequestId" default-value="${parameters.id}"/>
                <entity-one entity-name="CustRequest" value-field="custRequest"/>
                <get-related-one value-field="custRequest" relation-name="CustRequestType" to-value-field="custRequestType"/>
                <get-related-one value-field="custRequest" relation-name="StatusItem" to-value-field="statusItem"/>
                <get-related-one value-field="custRequest" relation-name="CurrencyUom" to-value-field="currency"/>
                <get-related-one value-field="custRequest" relation-name="ProductStore" to-value-field="store"/>
                <get-related-one value-field="custRequest" relation-name="FulfillContactMech" to-value-field="fulfillContactMech"/>
                <!-- <entity-and list="requestWorkEfforts" entity-name="CustRequestAndWorkEffort">
                    <field-map field-name="custRequestId" from-field="parameters.custRequestId"/>
                </entity-and>
                 --><get-related value-field="custRequest" relation-name="CustRequestParty" list="requestParties"/>
                <set field="orderBy[]" value="sequenceNum"/>
                <get-related value-field="custRequest" relation-name="CustRequestItem" list="custRequestItems" order-by-list="orderBy"/>
            </actions>
            <widgets>
                <container style="lefthalf">
                    <screenlet title="Request  ${custRequest.custRequestId}  ${uiLabelMap.CommonInformation}">
                        <include-form name="requestInfo" location="component://materialmgmt/widget/MaterialRequestForms.xml"/>
                    </screenlet>
                </container>
                <container style="righthalf">
                    <screenlet title="Request Status" navigation-form-name="ViewRequest">
                        <include-form name="ViewRequestStatus" location="component://materialmgmt/widget/MaterialRequestForms.xml"/>
                    </screenlet>
                </container>
                <container style="clear"/>
                <screenlet title="Request Items">
                    <include-form name="OverviewRequestItems" location="component://materialmgmt/widget/MaterialRequestForms.xml"/>
                </screenlet>
            </widgets>
        </section>
    </screen>
    
    <screen name="ViewMaterialRequest">
        <section>
            <actions>
                <set field="headerItem" value="request"/>
                <set field="tabButtonItem" value="FindMaterialRequest" />
                <set field="custRequestId" from-field="parameters.custRequestId" default-value="${parameters.id}"/>
                <entity-one entity-name="CustRequest" value-field="custRequest"/>	
            </actions>
            <widgets>
               <decorator-screen name="materialmgmtNgCommonDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                    	<!-- <include-menu name="RequestSubTabBar" location="component://materialmgmt/widget/materialmgmtMenus.xml"/> -->
                        <include-screen name="ViewCustRequest"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
</screens>